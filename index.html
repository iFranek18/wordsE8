<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>E8 Quest: RGB Edition</title>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>
    <style>
        :root { 
            --accent: #7289da; --neon: #00f2ff; --bg: #05050a; 
            --card: rgba(20, 20, 35, 0.9); --text: #e0e0e0;
        }
        body { margin:0; font-family: 'Inter', sans-serif; background: var(--bg); color: var(--text); overflow: hidden; height: 100vh; }
        
        /* ANIMOWANE T≈ÅO RGB */
        .rgb-bg {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1;
            background: linear-gradient(0deg, rgba(5,5,10,1) 0%, rgba(10,10,25,1) 100%);
            overflow: hidden;
        }
        .line {
            position: absolute; width: 2px; height: 30vh;
            background: linear-gradient(to bottom, transparent, var(--c), transparent);
            filter: blur(2px); animation: move linear infinite; opacity: 0.4;
        }
        @keyframes move {
            0% { transform: translateY(-100%) translateX(0); }
            100% { transform: translateY(110vh) translateX(20px); }
        }

        .app { max-width: 480px; margin: 0 auto; padding: 15px; height: 100vh; box-sizing: border-box; position: relative; overflow-y: auto; }
        .hidden { display: none !important; }
        
        /* UI ELEMENTS */
        .profile-card { 
            background: var(--card); padding: 15px; border-radius: 15px; 
            border: 1px solid rgba(255,255,255,0.1); backdrop-filter: blur(10px);
            display: flex; align-items: center; gap: 15px; position: relative; margin-bottom: 15px;
        }
        .avatar-main { font-size: 2.2rem; width: 60px; height: 60px; background: #252545; display: flex; align-items: center; justify-content: center; border-radius: 12px; border: 2px solid var(--neon); box-shadow: 0 0 10px var(--neon); }
        
        button { width: 100%; padding: 14px; border-radius: 10px; border: none; font-weight: 700; cursor: pointer; margin-top: 8px; transition: 0.2s; text-transform: uppercase; }
        .btn-main { background: var(--accent); color: white; border-bottom: 4px solid #4a5da0; }
        .btn-ranked { background: #ff5252; color: white; border-bottom: 4px solid #b33939; }
        .btn-shop { background: #33d9b2; color: white; border-bottom: 4px solid #218c74; }
        
        input { width: 100%; padding: 15px; border-radius: 10px; border: 1px solid #333; background: #000; color: var(--neon); font-size: 1rem; text-align: center; box-sizing: border-box; }
        
        .leader-box { background: var(--card); border-radius: 15px; padding: 12px; margin-top: 15px; }
        .row { display: flex; align-items: center; justify-content: space-between; padding: 8px; margin: 4px 0; border-radius: 6px; background: rgba(255,255,255,0.03); }
        .row.rank-1 { border: 1px solid #ffcc00; box-shadow: 0 0 8px rgba(255,204,0,0.4); }

        .settings-tab { margin-top: 20px; text-align: left; }
        .slider-box { margin: 15px 0; }
        label { display: block; margin-bottom: 5px; font-size: 0.8rem; color: #aaa; }
    </style>
</head>
<body>

<div class="rgb-bg" id="rgb-container"></div>

<div class="app" id="screen-menu">
    <div class="profile-card">
        <div class="avatar-main" id="p-avatar">üë∂üèª</div>
        <div class="user-info">
            <h2 id="p-name" style="margin:0">GRACZ</h2>
            <p style="margin:0; color:var(--neon)"><span id="p-cups">0</span> RP</p>
        </div>
        <div style="margin-left:auto; cursor:pointer" onclick="showScreen('screen-settings')">‚öôÔ∏è</div>
    </div>

    <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px; margin-bottom:15px">
        <div style="background:var(--card); padding:10px; border-radius:10px; text-align:center">MONETY: <span id="p-coins" style="color:#ffb142">0</span></div>
        <div style="background:var(--card); padding:10px; border-radius:10px; text-align:center">BOMBY: <span id="p-bombs" style="color:#ff5252">0</span></div>
    </div>

    <button class="btn-main" onclick="startMode('practice')">TRENING S≈Å√ìWEK</button>
    <button class="btn-main" style="background:#34ace0" onclick="startMode('sentence')">UK≈ÅADANIE ZDA≈É üß©</button>
    <button class="btn-ranked" onclick="startMode('ranked')">MECZ RANKINGOWY ‚öîÔ∏è</button>

    <div class="leader-box">
        <h4 style="margin:0 0 10px 0; color:var(--accent)">RANKING GLOBALNY</h4>
        <div id="leader-list">≈ÅƒÖczenie...</div>
    </div>

    <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px; margin-top:10px">
        <button class="btn-shop" onclick="showScreen('screen-shop')">CZARNY RYNEK</button>
        <button style="background:#474787; color:white" onclick="showScreen('screen-words')">BIBLIOTEKA</button>
    </div>
</div>

<div class="app hidden" id="screen-game">
    <div style="text-align:left; font-family:monospace; color:var(--neon); margin-bottom: 20px;">
        > TRYB: <span id="g-info">POZIOM 1</span><br>
        > POSTƒòP: <span id="g-progress">0/0</span>
    </div>
    <div id="g-word" style="font-size: 2rem; margin: 30px 0; font-weight:bold; text-align:center">S≈ÅOWO</div>
    <div id="sentence-box" style="margin-bottom: 20px; display:flex; flex-wrap:wrap; justify-content:center"></div>
    <input type="text" id="g-input" placeholder="Wpisz t≈Çumaczenie..." autocomplete="off">
    <div id="g-feedback" style="margin: 20px 0; font-weight: bold; min-height: 20px; text-align:center"></div>
    <button class="btn-shop" onclick="useBomb()">U≈ªYJ BOMBY (üí£)</button>
    <button style="background:transparent; color:#555" onclick="exitGame()">PRZERWIJ MISJƒò</button>
</div>

<div class="app hidden" id="screen-settings">
    <button style="background:#333; color:white" onclick="showScreen('screen-menu')">POWR√ìT</button>
    <h2 style="color:var(--neon)">USTAWIENIA</h2>
    
    <div class="settings-tab">
        <label>TW√ìJ NICK:</label>
        <input type="text" id="set-name" onchange="updateProfileName()">
        
        <div class="slider-box">
            <label>G≈ÅO≈öNO≈öƒÜ MUZYKI: <span id="val-music">50</span>%</label>
            <input type="range" min="0" max="100" value="50" oninput="updateVol('music', this.value)">
        </div>
        
        <div class="slider-box">
            <label>EFEKTY D≈πWIƒòKOWE: <span id="val-sfx">80</span>%</label>
            <input type="range" min="0" max="100" value="80" oninput="updateVol('sfx', this.value)">
        </div>
    </div>
    
    <button style="background:#ff5252; color:white; margin-top:40px" onclick="resetGame()">RESETUJ DANE</button>
</div>

<div class="app hidden" id="screen-shop">
    <button style="background:#333; color:white" onclick="showScreen('screen-menu')">POWR√ìT</button>
    <h2 style="color:var(--neon)">ULEPSZENIA</h2>
    <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px" id="reward-list"></div>
</div>

<script>
// --- FIREBASE I DANE ---
const firebaseConfig = {
    apiKey: "AIzaSyCREz6ZMk86TW-dASBLNIHUTr5XDXZrTPE",
    authDomain: "english-game-d3ccd.firebaseapp.com",
    databaseURL: "https://english-game-d3ccd-default-rtdb.europe-west1.firebasedatabase.app",
    projectId: "english-game-d3ccd",
    storageBucket: "english-game-d3ccd.firebasestorage.app",
    messagingSenderId: "314380492870",
    appId: "1:314380492870:web:4efbbe6b98fe0ff45cea47"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

const WORDS = [{en:"power", pl:"moc"}, {en:"danger", pl:"niebezpieczenstwo"}, {en:"code", pl:"kod"}, {en:"level", pl:"poziom"}];
const S_SENTENCES = [{mix: ["system", "is", "ready"], correct: "system is ready"}];

// --- AUDIO SYSTEM ---
const audio = {
    bgm: new Audio('https://www.soundhelix.com/examples/mp3/SoundHelix-Song-15.mp3'),
    win: new Audio('https://actions.google.com/sounds/v1/cartoon/clime_up_the_ladder.ogg'),
    lose: new Audio('https://actions.google.com/sounds/v1/cartoon/boing.ogg'),
    musicVol: 0.5, sfxVol: 0.8
};
audio.bgm.loop = true;

function updateVol(type, val) {
    let v = val / 100;
    if(type === 'music') { audio.bgm.volume = v; audio.musicVol = v; document.getElementById('val-music').textContent = val; }
    else { audio.sfxVol = v; document.getElementById('val-sfx').textContent = val; }
    if(audio.bgm.paused) audio.bgm.play();
}

function playSFX(sound) {
    let s = audio[sound].cloneNode();
    s.volume = audio.sfxVol;
    s.play();
}

// --- RGB BACKGROUND ---
function createRGB() {
    const container = document.getElementById('rgb-container');
    const colors = ['#00f2ff', '#7289da', '#33d9b2', '#ff5252', '#ffb142'];
    for(let i=0; i<15; i++) {
        let l = document.createElement('div');
        l.className = 'line';
        l.style.left = Math.random() * 100 + '%';
        l.style.setProperty('--c', colors[Math.floor(Math.random()*colors.length)]);
        l.style.animationDuration = (Math.random() * 3 + 2) + 's';
        l.style.animationDelay = Math.random() * 5 + 's';
        container.appendChild(l);
    }
}
createRGB();

// --- LOGIKA GRY ---
let myId = localStorage.getItem('e8_uuid') || 'u_' + Math.random().toString(36).substr(2, 9);
localStorage.setItem('e8_uuid', myId);

let user = JSON.parse(localStorage.getItem('e8_rgb_v1')) || {
    name: "Gracz_" + Math.floor(Math.random()*999), avatar: "üë∂üèª", cups: 0, coins: 100, bombs: 1, mult: 1
};

function save() {
    localStorage.setItem('e8_rgb_v1', JSON.stringify(user));
    db.ref('players/' + myId).set({ name: user.name, avatar: user.avatar, cups: user.cups });
    updateUI();
}

function updateUI() {
    document.getElementById('p-name').textContent = user.name.toUpperCase();
    document.getElementById('p-avatar').textContent = user.avatar;
    document.getElementById('p-cups').textContent = user.cups;
    document.getElementById('p-coins').textContent = user.coins;
    document.getElementById('p-bombs').textContent = user.bombs;
}

db.ref('players').orderByChild('cups').limitToLast(10).on('value', (snap) => {
    const list = [];
    snap.forEach(s => list.push({...s.val(), id: s.key}));
    list.sort((a,b) => b.cups - a.cups);
    document.getElementById('leader-list').innerHTML = list.map((p, idx) => `
        <div class="row ${idx===0?'rank-1':''}">
            <span>${idx+1}. ${p.avatar} ${p.name}</span>
            <span style="color:var(--neon)">${p.cups} RP</span>
        </div>
    `).join('');
});

let game = { mode: '', pool: [], idx: 0 };
function startMode(mode) {
    if(audio.bgm.paused) audio.bgm.play();
    game.mode = mode; game.idx = 0;
    game.pool = mode === 'sentence' ? [...S_SENTENCES] : [...WORDS];
    game.pool.sort(() => 0.5 - Math.random());
    showScreen('screen-game');
    loadQ();
}

function loadQ() {
    let q = game.pool[game.idx];
    document.getElementById('g-input').value = "";
    document.getElementById('g-feedback').textContent = "";
    document.getElementById('g-progress').textContent = `${game.idx+1}/${game.pool.length}`;
    if(game.mode === 'sentence') {
        document.getElementById('g-word').textContent = "U≈Å√ì≈ª ZDANIE:";
        document.getElementById('sentence-box').innerHTML = q.mix.map(w => `<span style="padding:10px; border:1px solid var(--neon); margin:5px; border-radius:5px; cursor:pointer" onclick="addW('${w}')">${w}</span>`).join('');
    } else {
        document.getElementById('g-word').textContent = q.en.toUpperCase();
        document.getElementById('sentence-box').innerHTML = "";
    }
}

function addW(w) { document.getElementById('g-input').value += w + " "; }

document.getElementById('g-input').onkeydown = (e) => {
    if(e.key === 'Enter') {
        let ans = e.target.value.toLowerCase().trim();
        let correct = game.mode === 'sentence' ? game.pool[game.idx].correct : game.pool[game.idx].pl;
        if(ans === correct) {
            playSFX('win');
            user.coins += 10; game.idx++;
            if(game.idx >= game.pool.length) { user.cups += 50; alert("MISJA UKO≈ÉCZONA! +50 RP"); exitGame(); }
            else loadQ();
        } else {
            playSFX('lose');
            document.getElementById('g-feedback').textContent = "B≈ÅƒÑD! POPRAWNIE: " + correct.toUpperCase();
            document.getElementById('g-feedback').style.color = "#ff5252";
        }
        save();
    }
};

function useBomb() {
    if(user.bombs > 0) {
        user.bombs--;
        let correct = game.mode === 'sentence' ? game.pool[game.idx].correct : game.pool[game.idx].pl;
        alert("WSKAZ√ìWKA: " + correct[0].toUpperCase());
        save();
    }
}

function updateProfileName() { user.name = document.getElementById('set-name').value; save(); }
function showScreen(id) { document.querySelectorAll('.app').forEach(s => s.classList.add('hidden')); document.getElementById(id).classList.remove('hidden'); }
function exitGame() { showScreen('screen-menu'); }
function resetGame() { if(confirm("CZY NA PEWNO?")) { localStorage.clear(); location.reload(); } }

save();
</script>
</body>
</html>
