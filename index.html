<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>E8 Quest: Cyber Trainer</title>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>
    <style>
        :root { 
            --accent: #7289da; --neon: #00f2ff; --bg: #0e0e1a; 
            --card: #1a1a2e; --text: #e0e0e0; --gold: #ffcc00; --silver: #e0e0e0; --bronze: #cd7f32;
        }
        body { margin:0; font-family: 'Inter', 'Segoe UI', sans-serif; background: var(--bg); color: var(--text); overflow-x: hidden; }
        .app { max-width: 480px; margin: 0 auto; padding: 15px; min-height: 100vh; box-sizing: border-box; }
        .hidden { display: none !important; }
        
        /* Profile Header - Teen Style */
        .profile-card { 
            background: var(--card); padding: 20px; border-radius: 15px; 
            border-left: 5px solid var(--accent);
            display: flex; align-items: center; gap: 15px; position: relative; margin-bottom: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }
        .avatar-main { 
            font-size: 2.5rem; width: 70px; height: 70px; background: #252545;
            display: flex; align-items: center; justify-content: center; border-radius: 12px; border: 2px solid var(--accent);
        }
        .user-info h2 { margin: 0; font-size: 1.2rem; letter-spacing: 1px; }
        .user-info p { margin: 2px 0 0; color: var(--neon); font-family: monospace; font-size: 1.1rem; }
        .settings-icon { position: absolute; top: 15px; right: 15px; cursor: pointer; opacity: 0.6; }

        /* HUD - Cyber Style */
        .hud-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 20px; }
        .stat-box { background: #252545; padding: 12px; border-radius: 10px; text-align: center; border: 1px solid rgba(255,255,255,0.05); }

        /* Buttons - Modern */
        button { 
            width: 100%; padding: 15px; border-radius: 10px; border: none; font-weight: 700; 
            cursor: pointer; margin-top: 10px; transition: 0.2s; font-size: 0.9rem; text-transform: uppercase;
        }
        .btn-play { background: var(--accent); color: white; box-shadow: 0 4px 0 #5b6eae; }
        .btn-play:active { transform: translateY(3px); box-shadow: none; }
        .btn-sentence { background: #34ace0; color: white; }
        .btn-ranked { background: #ff5252; color: white; }
        .btn-shop { background: #33d9b2; color: white; }

        /* Leaderboard - Epic Top 3 */
        .leader-box { background: var(--card); border-radius: 15px; padding: 15px; margin-top: 20px; }
        .row { display: flex; align-items: center; justify-content: space-between; padding: 10px; margin: 5px 0; border-radius: 8px; background: rgba(255,255,255,0.02); }
        .row.rank-1 { border: 2px solid var(--gold); box-shadow: 0 0 15px rgba(255,204,0,0.3); background: rgba(255,204,0,0.05); }
        .row.rank-2 { border: 1px solid var(--silver); background: rgba(224,224,224,0.05); }
        .row.rank-3 { border: 1px solid var(--bronze); background: rgba(205,127,50,0.05); }
        
        /* Shop & Rewards */
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .item-card { background: #252545; padding: 15px; border-radius: 12px; text-align: center; border: 1px solid rgba(255,255,255,0.1); }
        .item-card.locked { opacity: 0.4; filter: grayscale(1); }

        /* Inputs */
        input { 
            width: 100%; padding: 15px; border-radius: 10px; border: 1px solid #333; 
            background: #000; color: var(--neon); font-size: 1rem; text-align: center; margin-top: 10px;
        }
    </style>
</head>
<body>

<div class="app" id="screen-menu">
    <div class="profile-card">
        <div class="avatar-main" id="p-avatar">üë∂üèª</div>
        <div class="user-info">
            <h2 id="p-name">USER_ID</h2>
            <p><span id="p-cups">0</span> RP</p>
        </div>
        <div class="settings-icon" onclick="showScreen('screen-settings')">‚öôÔ∏è</div>
    </div>

    <div class="hud-grid">
        <div class="stat-box">CREDITS: <span id="p-coins" style="color: #ffb142">0</span></div>
        <div class="stat-box">BOMBS: <span id="p-bombs" style="color: #ff5252">0</span></div>
    </div>

    <button class="btn-play" onclick="startMode('practice')">TRAINING SESSIONS</button>
    <button class="btn-sentence" onclick="startMode('sentence')">SENTENCE BUILDER üß©</button>
    <button class="btn-ranked" onclick="startMode('ranked')">RANKED MATCH ‚öîÔ∏è</button>

    <div class="leader-box">
        <h4 style="margin: 0 0 10px 0; text-transform: uppercase; color: var(--accent);">Global Leaderboard</h4>
        <div id="leader-list">Connecting...</div>
    </div>

    <div class="grid" style="margin-top:10px">
        <button class="btn-shop" onclick="showScreen('screen-shop')">BLACK MARKET</button>
        <button style="background:#474787; color:white" onclick="showScreen('screen-words')">DB_LIBRARY</button>
    </div>
</div>

<div class="app hidden" id="screen-game">
    <div style="text-align:left; font-family:monospace; color:var(--neon); margin-bottom: 20px;">
        > SESSION_MODE: <span id="g-info">1</span><br>
        > PROGRESS: <span id="g-progress">0/0</span>
    </div>
    <div id="g-word" style="font-size: 2rem; margin: 30px 0; font-weight:bold; color:white;">WORD</div>
    <div id="sentence-box" style="margin-bottom: 20px;"></div>
    <input type="text" id="g-input" placeholder="Enter translation..." spellcheck="false">
    <div id="g-feedback" style="margin: 20px 0; font-weight: bold; min-height: 20px; font-family:monospace;"></div>
    <button class="btn-shop" onclick="useBomb()">ACTIVATE HINT (üí£)</button>
    <button style="background:transparent; color:#555" onclick="exitGame()">ABORT MISSION</button>
</div>

<div class="app hidden" id="screen-shop">
    <button style="background:#333; color:white" onclick="showScreen('screen-menu')">BACK</button>
    <h2 style="color:var(--neon)">UPGRADES</h2>
    <div class="grid">
        <div class="item-card">
            <div>üí£ BOMB</div>
            <button class="btn-shop" onclick="buyItem('bomb', 50)">50 üí∞</button>
        </div>
        <div class="item-card">
            <div>üìà BOOST x2</div>
            <button class="btn-shop" onclick="buyItem('mult', 400)">400 üí∞</button>
        </div>
    </div>

    <h2 style="color:var(--accent); margin-top:20px">REWARDS_LIST</h2>
    <div id="reward-list" class="grid"></div>
</div>

<div class="app hidden" id="screen-settings">
    <button style="background:#333; color:white" onclick="showScreen('screen-menu')">BACK</button>
    <h2>SYSTEM_SETTINGS</h2>
    <input type="text" id="set-name" placeholder="Change Nickname" onchange="updateProfileName()">
    <button style="background:#ff5252; color:white; margin-top:50px" onclick="resetGame()">WIPE DATA (RESET)</button>
</div>

<script>
const firebaseConfig = {
    apiKey: "AIzaSyCREz6ZMk86TW-dASBLNIHUTr5XDXZrTPE",
    authDomain: "english-game-d3ccd.firebaseapp.com",
    databaseURL: "https://english-game-d3ccd-default-rtdb.europe-west1.firebasedatabase.app",
    projectId: "english-game-d3ccd",
    storageBucket: "english-game-d3ccd.firebasestorage.app",
    messagingSenderId: "314380492870",
    appId: "1:314380492870:web:4efbbe6b98fe0ff45cea47"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

const WORDS = [{en:"power", pl:"moc"}, {en:"danger", pl:"niebezpiecze≈Ñstwo"}, {en:"code", pl:"kod"}, {en:"level", pl:"poziom"}];
const S_SENTENCES = [
    {mix: ["system", "is", "ready"], correct: "system is ready"},
    {mix: ["access", "granted", "is"], correct: "access is granted"}
];

const REWARDS = [
    {cups: 0, icon: "üë∂üèª", name: "Rookie"},
    {cups: 500, icon: "üé∏", name: "Rockstar"},
    {cups: 1000, icon: "üéÆ", name: "Pro Gamer"},
    {cups: 1250, icon: "üí™üèΩ", name: "Strongman"},
    {cups: 1500, icon: "üéÖüèª", name: "X-Mas Mode"},
    {cups: 1750, icon: "üïµüèª", name: "Spy"},
    {cups: 2000, icon: "üñïüèº", name: "Rebel"},
    {cups: 2500, icon: "üë®üèº‚Äç‚úàÔ∏è", name: "Captain"},
    {cups: 3000, icon: "üèÖ", name: "The Legend"}
];

let myId = localStorage.getItem('e8_uuid') || 'u_' + Math.random().toString(36).substr(2, 9);
localStorage.setItem('e8_uuid', myId);

let user = JSON.parse(localStorage.getItem('e8_cyber_v1')) || {
    name: "Player_" + Math.floor(Math.random()*999), avatar: "üë∂üèª", cups: 0, coins: 100, bombs: 1, mult: 1
};

function save() {
    localStorage.setItem('e8_cyber_v1', JSON.stringify(user));
    db.ref('players/' + myId).set({ name: user.name, avatar: user.avatar, cups: user.cups });
    updateUI();
}

function updateUI() {
    document.getElementById('p-name').textContent = user.name;
    document.getElementById('p-avatar').textContent = user.avatar;
    document.getElementById('p-cups').textContent = user.cups;
    document.getElementById('p-coins').textContent = user.coins;
    document.getElementById('p-bombs').textContent = user.bombs;
    renderRewards();
}

function renderRewards() {
    const list = document.getElementById('reward-list');
    list.innerHTML = REWARDS.map(r => {
        const isUnlocked = user.cups >= r.cups;
        return `
            <div class="item-card ${isUnlocked ? '' : 'locked'}">
                <div style="font-size:1.5rem">${r.icon}</div>
                <small>${r.cups} RP</small>
                <button style="padding:5px; font-size:0.7rem; background:${user.avatar === r.icon ? '#ffb142':'#333'}" 
                    onclick="setAvatar('${r.icon}')" ${isUnlocked ? '' : 'disabled'}>
                    ${user.avatar === r.icon ? 'ACTIVE' : (isUnlocked ? 'EQUIP' : 'LOCKED')}
                </button>
            </div>
        `;
    }).join('');
}

// RANKING - Epic Top 3
db.ref('players').orderByChild('cups').limitToLast(10).on('value', (snap) => {
    const list = [];
    snap.forEach(s => list.push({...s.val(), id: s.key}));
    list.sort((a,b) => b.cups - a.cups);
    
    document.getElementById('leader-list').innerHTML = list.map((p, idx) => {
        let rankClass = "";
        let trophy = idx + 1;
        if(idx === 0) { rankClass = "rank-1"; trophy = "ü•á"; }
        if(idx === 1) { rankClass = "rank-2"; trophy = "ü•à"; }
        if(idx === 2) { rankClass = "rank-3"; trophy = "ü•â"; }
        
        return `
            <div class="row ${rankClass}">
                <div style="display:flex; align-items:center; gap:10px">
                    <div style="width:25px">${trophy}</div>
                    <div style="font-size:1.2rem">${p.avatar}</div>
                    <div style="font-weight:bold">${p.name}</div>
                </div>
                <div style="color:var(--neon)">${p.cups}</div>
            </div>
        `;
    }).join('');
});

// GAME LOGIC
let game = { mode: '', pool: [], idx: 0 };
function startMode(mode) {
    game.mode = mode; game.idx = 0;
    game.pool = mode === 'sentence' ? [...S_SENTENCES] : [...WORDS];
    game.pool.sort(() => 0.5 - Math.random());
    showScreen('screen-game');
    loadQ();
}

function loadQ() {
    let q = game.pool[game.idx];
    document.getElementById('g-input').value = "";
    document.getElementById('g-feedback').textContent = "";
    document.getElementById('g-progress').textContent = `${game.idx+1}/${game.pool.length}`;
    const sBox = document.getElementById('sentence-box');
    if(game.mode === 'sentence') {
        document.getElementById('g-word').textContent = "DECODE SENTENCE:";
        sBox.innerHTML = q.mix.map(w => `<span class="pill" style="border-color:var(--neon); color:var(--neon)" onclick="addWord('${w}')">${w}</span>`).join('');
    } else {
        document.getElementById('g-word').textContent = q.en.toUpperCase();
        sBox.innerHTML = "";
    }
}

function addWord(w) { document.getElementById('g-input').value += w + " "; }

document.getElementById('g-input').onkeydown = (e) => {
    if(e.key === 'Enter') {
        let ans = e.target.value.toLowerCase().trim();
        let correct = game.mode === 'sentence' ? game.pool[game.idx].correct : game.pool[game.idx].pl;
        if(ans === correct) {
            user.coins += (10 * user.mult);
            game.idx++;
            if(game.idx >= game.pool.length) {
                user.cups += 50;
                alert("ACCESS GRANTED. +50 RP"); exitGame();
            } else loadQ();
        } else {
            document.getElementById('g-feedback').textContent = "ERROR: Expected [" + correct + "]";
            document.getElementById('g-feedback').style.color = "#ff5252";
        }
        save();
    }
};

function buyItem(type, price) {
    if(user.coins >= price) {
        user.coins -= price;
        if(type === 'bomb') user.bombs++;
        if(type === 'mult') user.mult = 2;
        save(); alert("PURCHASE COMPLETE.");
    } else alert("INSUFFICIENT CREDITS.");
}

function useBomb() {
    if(user.bombs > 0) {
        user.bombs--;
        let correct = game.mode === 'sentence' ? game.pool[game.idx].correct : game.pool[game.idx].pl;
        alert("DECRYPTED: " + correct[0].toUpperCase());
        save();
    }
}

function setAvatar(a) { user.avatar = a; save(); }
function updateProfileName() { user.name = document.getElementById('set-name').value; save(); }
function showScreen(id) { 
    document.querySelectorAll('.app').forEach(s => s.classList.add('hidden')); 
    document.getElementById(id).classList.remove('hidden'); 
}
function exitGame() { showScreen('screen-menu'); }
function resetGame() { if(confirm("SYSTEM WIPE?")) { localStorage.clear(); location.reload(); } }

updateUI();
</script>
</body>
</html>
