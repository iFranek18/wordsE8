<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>E8 CyberQuest: Ultimate</title>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@900&family=Inter:wght@400;800&display=swap" rel="stylesheet">
    <style>
        :root { --p: #7289da; --neon: #00f2ff; --bg: #05050a; --card: rgba(25, 25, 45, 0.95); }
        body { margin:0; font-family: 'Inter', sans-serif; background: var(--bg); color: #fff; overflow: hidden; height: 100vh; }
        .rgb-bg { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; background: #000; overflow: hidden; }
        .line { position: absolute; width: 2px; height: 40vh; filter: blur(2px); animation: move linear infinite; opacity: 0.3; }
        @keyframes move { 0% { transform: translateY(-110%) rotate(5deg); } 100% { transform: translateY(110vh) rotate(5deg); } }

        .app { max-width: 480px; margin: 0 auto; padding: 15px; height: 100vh; display: flex; flex-direction: column; box-sizing: border-box; position: relative; }
        .hidden { display: none !important; }

        /* BRAWL ROAD */
        .road-container { background: rgba(0,0,0,0.4); border-radius: 20px; border: 1px solid #333; margin-bottom: 15px; padding: 10px 0; }
        .road-scroll { display: flex; overflow-x: auto; gap: 20px; padding: 10px 20px; scrollbar-width: none; }
        .road-scroll::-webkit-scrollbar { display: none; }
        .node { flex: 0 0 70px; text-align: center; cursor: pointer; }
        .node-box { width: 60px; height: 60px; background: var(--card); border-radius: 15px; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; border: 2px solid #444; margin-bottom: 5px; }
        .unlocked .node-box { border-color: var(--neon); box-shadow: 0 0 10px var(--neon); }
        .claimed .node-box { background: #00b894; border-color: #fff; }

        /* PROFILE */
        .profile-card { background: var(--card); padding: 12px; border-radius: 20px; border: 1px solid var(--p); display: flex; align-items: center; gap: 12px; margin-bottom: 10px; }
        
        /* BUTTONS */
        button { width: 100%; padding: 15px; border-radius: 14px; border: none; font-weight: 800; cursor: pointer; margin-top: 8px; font-family: 'Orbitron'; text-transform: uppercase; }
        .btn-blue { background: linear-gradient(135deg, #00d2ff, #3a7bd5); color: white; }
        .btn-purple { background: linear-gradient(135deg, #6c5ce7, #a29bfe); color: white; }
        .btn-ranked { background: linear-gradient(135deg, #ff416c, #ff4b2b); color: white; }
        .btn-spotify { background: #1DB954; color: white; font-size: 0.7rem; }

        input { width: 100%; padding: 16px; border-radius: 12px; border: 2px solid #333; background: #000; color: var(--neon); font-size: 1.1rem; text-align: center; font-family: 'Orbitron'; box-sizing: border-box; }
        .pill { padding: 10px 15px; background: #1a1a2e; border: 1px solid var(--p); border-radius: 8px; margin: 4px; cursor: pointer; font-size: 0.9rem; display: inline-block; }
    </style>
</head>
<body>

<div class="rgb-bg" id="rgb-container"></div>

<div class="app" id="screen-menu">
    <div class="road-container">
        <div style="text-align:center; font-size:0.6rem; font-family:'Orbitron'; color:#888; margin-bottom:5px">PRZESUÅƒ NAGRODY ğŸ†</div>
        <div class="road-scroll" id="road-content"></div>
    </div>

    <div class="profile-card">
        <div style="font-size:1.8rem; width:50px; height:50px; background:#111; border-radius:12px; display:flex; align-items:center; justify-content:center; border:2px solid var(--neon)" id="p-avatar">ğŸ‘¶ğŸ»</div>
        <div style="flex:1">
            <h2 id="p-name" style="margin:0; font-size:0.8rem; font-family:'Orbitron'">GRACZ</h2>
            <div style="font-size:0.7rem">ğŸ† <span id="p-cups">0</span> | ğŸ’° <span id="p-coins">0</span> | ğŸ’£ <span id="p-bombs">0</span></div>
        </div>
        <div onclick="showScreen('screen-settings')" style="cursor:pointer; font-size:1.2rem">âš™ï¸</div>
    </div>

    <button class="btn-blue" onclick="startMode('words')">SÅÃ“WKA ğŸ“–</button>
    <button class="btn-purple" onclick="startMode('sentences')">UKÅADANIE ZDAÅƒ ğŸ§©</button>
    <button class="btn-ranked" onclick="startMode('ranked')">TRYB RANKINGOWY âš”ï¸</button>
    
    <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px; margin-top:5px">
        <button style="background:#2d3436; color:white" onclick="showScreen('screen-dictionary')">SÅOWNIK</button>
        <button style="background:#e67e22; color:white" onclick="showScreen('screen-shop')">SKLEP ğŸ’°</button>
    </div>

    <button class="btn-spotify" onclick="window.open('https://open.spotify.com/', '_blank')">OTWÃ“RZ SPOTIFY ğŸ§</button>

    <div style="background:var(--card); border-radius:15px; padding:10px; margin-top:10px; flex:1; overflow-y:auto">
        <h4 style="margin:0 0 5px 0; font-family:'Orbitron'; font-size:0.6rem; color:var(--neon)">RANKING</h4>
        <div id="leader-list"></div>
    </div>
</div>

<div class="app hidden" id="screen-game">
    <div style="display:flex; justify-content:space-between; color:var(--neon); font-family:'Orbitron'; font-size:0.8rem">
        <span id="g-mode-title">TRYB</span>
        <span>POSTÄ˜P: <span id="g-progress">0/10</span></span>
    </div>
    
    <div id="g-word" style="font-size: 1.6rem; margin: 30px 0; font-weight:900; text-align:center; font-family:'Orbitron'; color:var(--neon)">SÅOWO</div>
    
    <div id="sentence-box" style="margin-bottom: 20px; text-align:center; min-height:50px"></div>
    
    <input type="text" id="g-input" placeholder="WPISZ TÅUMACZENIE..." autocomplete="off">
    <div id="g-feedback" style="margin: 15px 0; text-align:center; font-weight:bold; min-height:20px"></div>
    
    <button class="btn-blue" style="background:#f1c40f; color:#000" onclick="useBomb()">POMOC ğŸ’£</button>
    <button style="background:transparent; color:#555" onclick="exitGame()">WYJDÅ¹</button>
</div>

<div class="app hidden" id="screen-shop">
    <button onclick="showScreen('screen-menu')">POWRÃ“T</button>
    <h2 style="font-family:'Orbitron'; text-align:center">SKLEP ğŸ’°</h2>
    <div class="profile-card" onclick="buyItem('bomb', 50)">
        <div style="font-size:1.5rem">ğŸ’£</div>
        <div style="flex:1">KUP BOMBÄ˜</div>
        <div style="color:var(--neon)">50 ğŸ’°</div>
    </div>
</div>

<div class="app hidden" id="screen-dictionary">
    <button onclick="showScreen('screen-menu')">POWRÃ“T</button>
    <h2 style="font-family:'Orbitron'; text-align:center">SÅOWNIK ğŸ“š</h2>
    <div id="dict-list" style="overflow-y:auto"></div>
</div>

<script>
// --- FIREBASE ---
const firebaseConfig = {
    apiKey: "AIzaSyCREz6ZMk86TW-dASBLNIHUTr5XDXZrTPE",
    authDomain: "english-game-d3ccd.firebaseapp.com",
    databaseURL: "https://english-game-d3ccd-default-rtdb.europe-west1.firebasedatabase.app",
    projectId: "english-game-d3ccd",
    storageBucket: "english-game-d3ccd.firebasestorage.app",
    messagingSenderId: "314380492870",
    appId: "1:314380492870:web:4efbbe6b98fe0ff45cea47"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// --- BAZA DANYCH ---
const ROAD_MAP = [
    {cups: 0, v: "ğŸ‘¶ğŸ»"}, {cups: 50, v: "ğŸ’°"}, {cups: 100, v: "ğŸ’£"}, 
    {cups: 150, v: "ğŸ¸"}, {cups: 200, v: "ğŸ’°"}, {cups: 300, v: "ğŸ®"},
    {cups: 400, v: "ğŸ’£"}, {cups: 500, v: "ğŸ”¥"}, {cups: 600, v: "ğŸ’°"},
    {cups: 800, v: "ğŸ’ªğŸ½"}, {cups: 1000, v: "ğŸ…"}
];

const WORDS = [
    {en: "Apple", pl: "jabÅ‚ko"}, {en: "Dog", pl: "pies"}, {en: "Cat", pl: "kot"},
    {en: "Water", pl: "woda"}, {en: "School", pl: "szkoÅ‚a"}, {en: "Friend", pl: "przyjaciel"}
];

const SENTENCES = [
    {en: "I like apples", pl: "lubiÄ™ jabÅ‚ka", mix: ["apples", "I", "like"]},
    {en: "This is my dog", pl: "to jest mÃ³j pies", mix: ["is", "dog", "this", "my"]},
    {en: "I go to school", pl: "chodzÄ™ do szkoÅ‚y", mix: ["to", "go", "I", "school"]}
];

// --- LOGIKA ---
let user = JSON.parse(localStorage.getItem('e8_final_v1')) || {
    name: "GRACZ", avatar: "ğŸ‘¶ğŸ»", cups: 0, coins: 100, bombs: 3, claimed: []
};

let game = { mode: '', pool: [], idx: 0, dir: 'en2pl' };

function normalize(s) { 
    if(!s) return "";
    return s.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "").replace(/Å‚/g, "l").trim(); 
}

function save() {
    localStorage.setItem('e8_final_v1', JSON.stringify(user));
    db.ref('players/' + (localStorage.getItem('e8_id') || 'u1')).set({
        name: user.name, cups: user.cups, avatar: user.avatar
    });
    updateUI();
}

function updateUI() {
    document.getElementById('p-name').textContent = user.name;
    document.getElementById('p-avatar').textContent = user.avatar;
    document.getElementById('p-cups').textContent = user.cups;
    document.getElementById('p-coins').textContent = user.coins;
    document.getElementById('p-bombs').textContent = user.bombs;
    renderRoad();
}

function renderRoad() {
    const road = document.getElementById('road-content');
    road.innerHTML = ROAD_MAP.map(n => `
        <div class="node ${user.cups >= n.cups ? 'unlocked' : ''} ${user.claimed.includes(n.cups) ? 'claimed' : ''}" onclick="claim(${n.cups})">
            <div class="node-box">${user.claimed.includes(n.cups) ? 'âœ…' : n.v}</div>
            <div style="font-size:0.6rem; font-family:'Orbitron'">${n.cups} ğŸ†</div>
        </div>
    `).join('');
}

function claim(c) {
    if(user.cups >= c && !user.claimed.includes(c)) {
        const item = ROAD_MAP.find(n => n.cups === c);
        if(item.v === "ğŸ’°") user.coins += 100;
        else if(item.v === "ğŸ’£") user.bombs += 1;
        else user.avatar = item.v;
        user.claimed.push(c);
        save();
    }
}

function startMode(m) {
    game.mode = m; game.idx = 0;
    if(m === 'sentences') game.pool = [...SENTENCES].sort(() => 0.5 - Math.random());
    else game.pool = [...WORDS].sort(() => 0.5 - Math.random());
    
    showScreen('screen-game');
    document.getElementById('g-mode-title').textContent = m.toUpperCase();
    loadQ();
}

function loadQ() {
    let q = game.pool[game.idx];
    game.dir = Math.random() > 0.5 ? 'en2pl' : 'pl2en';
    
    document.getElementById('g-progress').textContent = `${game.idx+1}/${game.pool.length}`;
    document.getElementById('g-input').value = "";
    document.getElementById('g-feedback').textContent = "";
    
    const displayWord = game.dir === 'en2pl' ? q.en : q.pl;
    document.getElementById('g-word').textContent = displayWord.toUpperCase();

    const sBox = document.getElementById('sentence-box');
    sBox.innerHTML = "";
    if(game.mode === 'sentences') {
        const wordsToMix = game.dir === 'en2pl' ? q.pl.split(' ') : q.en.split(' ');
        wordsToMix.sort(() => 0.5 - Math.random()).forEach(w => {
            sBox.innerHTML += `<span class="pill" onclick="document.getElementById('g-input').value += '${w} '">${w}</span>`;
        });
    }
}

document.getElementById('g-input').onkeydown = e => {
    if(e.key === 'Enter') {
        let q = game.pool[game.idx];
        let correct = game.dir === 'en2pl' ? q.pl : q.en;
        
        if(normalize(e.target.value) === normalize(correct)) {
            game.idx++;
            user.coins += 5;
            if(game.idx >= game.pool.length) {
                user.cups += (game.mode === 'ranked' ? 30 : 10);
                alert("BRAWO! Zyskujesz pucharki!");
                exitGame();
            } else loadQ();
        } else {
            document.getElementById('g-feedback').textContent = "POPRAWNIE: " + correct.toUpperCase();
            document.getElementById('g-feedback').style.color = "#ff416c";
        }
        save();
    }
}

function useBomb() {
    if(user.bombs > 0) {
        let q = game.pool[game.idx];
        let correct = game.dir === 'en2pl' ? q.pl : q.en;
        alert("PODPOWIEDÅ¹: " + correct.substring(0, 3) + "...");
        user.bombs--;
        save();
    }
}

function buyItem(type, price) {
    if(user.coins >= price) {
        user.coins -= price;
        if(type === 'bomb') user.bombs++;
        save();
    }
}

function showScreen(id) {
    document.querySelectorAll('.app').forEach(s => s.classList.add('hidden'));
    document.getElementById(id).classList.remove('hidden');
    if(id === 'screen-dictionary') {
        document.getElementById('dict-list').innerHTML = WORDS.map(w => `<div class="profile-card"><b>${w.en}</b> - ${w.pl}</div>`).join('');
    }
}

function exitGame() { showScreen('screen-menu'); }

// RANKING
db.ref('players').orderByChild('cups').limitToLast(5).on('value', snap => {
    let list = []; snap.forEach(s => list.push(s.val()));
    document.getElementById('leader-list').innerHTML = list.reverse().map(p => `
        <div style="font-size:0.7rem; margin-bottom:4px">${p.avatar} ${p.name} - ${p.cups}ğŸ†</div>
    `).join('');
});

// START
const container = document.getElementById('rgb-container');
for(let i=0; i<10; i++) {
    let l = document.createElement('div'); l.className = 'line';
    l.style.left = Math.random()*100+'%'; l.style.background = `linear-gradient(to bottom, transparent, #00f2ff, transparent)`;
    l.style.animationDuration = (Math.random()*3+2)+'s'; container.appendChild(l);
}
if(!localStorage.getItem('e8_id')) localStorage.setItem('e8_id', 'u' + Date.now());
save();
</script>
</body>
</html>
