<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>English E8 Trainer</title>
    <style>
        :root {
            --primary: #00ffd5;
            --bg: linear-gradient(135deg,#0f2027,#203a43,#2c5364);
        }
        body{margin:0;font-family:system-ui;background:var(--bg);color:#fff;display:flex;align-items:center;justify-content:center;min-height:100vh}
        .app{width:min(420px,95%);background:rgba(255,255,255,.08);backdrop-filter:blur(14px);border-radius:20px;padding:20px;box-shadow:0 20px 50px rgba(0,0,0,.4)}
        button,select,input,label{width:100%;padding:12px;border-radius:12px;border:none;font-size:1rem;margin-top:10px;box-sizing: border-box}
        button{background:var(--primary);color:#000;font-weight:700;cursor:pointer;transition: transform 0.1s}
        button:active{transform: scale(0.98)}
        .small{font-size:.9rem;opacity:.8}
        .word{font-size:2rem;text-align:center;margin:15px 0;font-weight:700;min-height: 40px}
        .result{min-height:28px;text-align:center;font-weight:700;margin-top: 10px}
        .good{color:#3cff00}.bad{color:#ff3c3c}
        .back{background:none;color:#fff;font-size:1.6rem;width:auto;padding:0;margin:0;cursor:pointer}
        .topbar{display:flex;align-items:center;justify-content: space-between;margin-bottom:10px}
        .checkbox{display:flex;align-items:center;gap:10px;cursor: pointer}
        .checkbox input{width:auto;margin:0}
        .errors-list{max-height:200px;overflow-y:auto;margin-top:10px;padding:10px;background:rgba(0,0,0,0.3);border-radius:12px;font-size: 0.9rem}
        .stats-bar {display: flex; justify-content: space-between; font-size: 0.8rem; background: rgba(0,0,0,0.2); padding: 8px; border-radius: 8px; margin-bottom: 10px}
        hr {border: 0; border-top: 1px solid rgba(255,255,255,0.1); margin: 15px 0}
    </style>
</head>
<body>

<div class="app" id="menu">
  <h2>English E8 Trainer</h2>
  <p class="small">Wybierz zakres nauki</p>
  <select id="mode">
    <option value="all">Wszystko (mieszane)</option>
    <option value="nouns">Rzeczowniki</option>
    <option value="verbs">Czasowniki</option>
    <option value="adjectives">Przymiotniki</option>
    <option value="rest">Inne (zaimki, sp√≥jniki itp.)</option>
    <option value="wrong">Tylko Twoje b≈Çƒôdy</option>
  </select>

  <label class="checkbox">
    <input type="checkbox" id="noPolish" checked>
    Ignoruj polskie znaki (ƒÖ, ƒá, ƒô...)
  </label>

  <label class="checkbox">
    <input type="checkbox" id="direction"> Tryb EN ‚Üí PL
  </label>

  <button id="startBtn">START</button>
  
  <hr>
  <p class="small">B≈Çƒôdy w pamiƒôci: <b id="wrongCount">0</b></p>
  <button id="showErrorsBtn" style="background: rgba(255,255,255,0.1); color: white;">Poka≈º listƒô b≈Çƒôd√≥w</button>
  <div class="errors-list" id="errorsList" style="display:none"></div>
</div>

<div class="app" id="learn" style="display:none">
  <div class="topbar">
    <button class="back" id="backArrow">‚Üê</button>
    <div id="progressText" class="small">0 / 0</div>
  </div>
  
  <div class="stats-bar">
    <span>Poprawne: <b id="statCorrect" class="good">0</b></span>
    <span>B≈Çƒôdy: <b id="statWrong" class="bad">0</b></span>
  </div>

  <div class="word" id="question"></div>
  <input id="answer" placeholder="Wpisz t≈Çumaczenie..." autocomplete="off">
  <button id="checkBtn">Sprawd≈∫</button>
  <div class="result" id="result"></div>
</div>

<script>
const data = {
  nouns:[{en:"mother",pl:"mama"},{en:"father",pl:"tata"},{en:"parents",pl:"rodzice"},{en:"sister",pl:"siostra"},{en:"brother",pl:"brat"},{en:"grandmother",pl:"babcia"},{en:"grandfather",pl:"dziadek"},{en:"aunt",pl:"ciocia"},{en:"uncle",pl:"wujek"},{en:"cousin",pl:"kuzyn"},{en:"child",pl:"dziecko"},{en:"children",pl:"dzieci"},{en:"friend",pl:"przyjaciel"},{en:"school",pl:"szko≈Ça"},{en:"teacher",pl:"nauczyciel"},{en:"student",pl:"ucze≈Ñ"},{en:"house",pl:"dom"},{en:"room",pl:"pok√≥j"},{en:"food",pl:"jedzenie"},{en:"dog",pl:"pies"}],
  verbs:[{en:"be",pl:"byƒá"},{en:"have",pl:"mieƒá"},{en:"do",pl:"robiƒá"},{en:"go",pl:"i≈õƒá"},{en:"come",pl:"przychodziƒá"},{en:"make",pl:"robiƒá"},{en:"take",pl:"braƒá"},{en:"give",pl:"dawaƒá"},{en:"learn",pl:"uczyƒá siƒô"},{en:"study",pl:"uczyƒá siƒô"},{en:"see",pl:"widzieƒá"},{en:"watch",pl:"oglƒÖdaƒá"},{en:"play",pl:"graƒá"},{en:"work",pl:"pracowaƒá"}],
  adjectives:[{en:"happy",pl:"szczƒô≈õliwy"},{en:"sad",pl:"smutny"},{en:"angry",pl:"z≈Çy"},{en:"tired",pl:"zmƒôczony"},{en:"big",pl:"du≈ºy"},{en:"small",pl:"ma≈Çy"},{en:"easy",pl:"≈Çatwy"},{en:"difficult",pl:"trudny"},{en:"important",pl:"wa≈ºny"},{en:"interesting",pl:"interesujƒÖcy"}],
  rest:[
    {en:"I",pl:"ja"},{en:"you",pl:"ty / wy"},{en:"he",pl:"on"},{en:"she",pl:"ona"},{en:"it",pl:"ono / to"},{en:"we",pl:"my"},{en:"they",pl:"oni / one"},{en:"me",pl:"mnie / mi"},{en:"him",pl:"jego / mu"},{en:"her",pl:"jej"},{en:"us",pl:"nas / nam"},{en:"them",pl:"ich / im"},{en:"my",pl:"m√≥j"},{en:"your",pl:"tw√≥j / wasz"},{en:"his",pl:"jego"},{en:"its",pl:"jego / jej"},{en:"our",pl:"nasz"},{en:"their",pl:"ich"},
    {en:"what",pl:"co"},{en:"which",pl:"kt√≥ry / kt√≥ra / kt√≥re"},{en:"who",pl:"kto"},{en:"where",pl:"gdzie"},{en:"when",pl:"kiedy"},{en:"why",pl:"dlaczego"},{en:"how",pl:"jak"},
    {en:"in",pl:"w"},{en:"on",pl:"na"},{en:"at",pl:"przy / o"},{en:"to",pl:"do"},{en:"from",pl:"z / od"},{en:"with",pl:"z"},{en:"about",pl:"o"},{en:"for",pl:"dla / za"},{en:"and",pl:"i"},{en:"but",pl:"ale"},{en:"or",pl:"lub"},{en:"because",pl:"poniewa≈º"},{en:"so",pl:"wiƒôc"},{en:"if",pl:"je≈õli"}
  ]
};

let pool = [];
let current = null;
let wrong = JSON.parse(localStorage.getItem("wrong") || "[]");
let sessionCorrect = 0;
let sessionWrong = 0;
let initialPoolSize = 0;

// Elementy UI
const menu = document.getElementById("menu");
const learn = document.getElementById("learn");
const question = document.getElementById("question");
const answer = document.getElementById("answer");
const result = document.getElementById("result");
const wrongCountText = document.getElementById("wrongCount");
const statCorrectText = document.getElementById("statCorrect");
const statWrongText = document.getElementById("statWrong");
const progressText = document.getElementById("progressText");

// Inicjalizacja licznika b≈Çƒôd√≥w
wrongCountText.textContent = wrong.length;

document.getElementById("startBtn").addEventListener("click", start);
document.getElementById("checkBtn").addEventListener("click", check);
document.getElementById("backArrow").addEventListener("click", backToMenu);
document.getElementById("showErrorsBtn").addEventListener("click", () => {
    const list = document.getElementById("errorsList");
    list.style.display = list.style.display === 'none' ? 'block' : 'none';
    list.innerHTML = wrong.length ? wrong.map(w => `<div>${w.en} ‚Äî ${w.pl}</div>`).join('') : "Brak zapisanych b≈Çƒôd√≥w.";
});

answer.addEventListener("keydown", e => { if (e.key === "Enter") check(); });

function start() {
    const mode = document.getElementById("mode").value;
    
    // Tworzenie puli s≈Ç√≥wek (bez powt√≥rek - bƒôdziemy je usuwaƒá z tej tablicy)
    if (mode === "wrong") {
        pool = [...wrong];
    } else if (mode === "all") {
        pool = [...data.nouns, ...data.verbs, ...data.adjectives, ...data.rest];
    } else {
        pool = [...data[mode]];
    }

    if (pool.length === 0) {
        alert("Pula s≈Ç√≥wek jest pusta!");
        return;
    }

    // Reset statystyk sesji
    initialPoolSize = pool.length;
    sessionCorrect = 0;
    sessionWrong = 0;
    updateStats();

    menu.style.display = "none";
    learn.style.display = "block";
    next();
}

function next() {
    if (pool.length === 0) {
        finishGame();
        return;
    }

    // Losowanie bez powt√≥rek - wycinamy element z tablicy
    const index = Math.floor(Math.random() * pool.length);
    current = pool.splice(index, 1)[0];

    question.textContent = document.getElementById("direction").checked ? current.en : current.pl;
    answer.value = "";
    answer.disabled = false;
    result.textContent = "";
    result.className = "result";
    answer.focus();
}

function normalize(text) {
    let t = text.toLowerCase().trim();
    if (document.getElementById("noPolish").checked) {
        const map = {'ƒÖ':'a','ƒá':'c','ƒô':'e','≈Ç':'l','≈Ñ':'n','√≥':'o','≈õ':'s','≈∫':'z','≈º':'z'};
        t = t.replace(/[ƒÖƒáƒô≈Ç≈Ñ√≥≈õ≈∫≈º]/g, m => map[m]);
        t = t.normalize("NFD").replace(/[\u0300-\u036f]/g, "");
    }
    return t;
}

function check() {
    if (!current || answer.disabled) return;

    const userVal = normalize(answer.value);
    const correctRaw = document.getElementById("direction").checked ? current.pl : current.en;
    
    // Obs≈Çuga wielu poprawnych odpowiedzi (np. "ty / wy")
    const possibleAnswers = correctRaw.split(/[/,]/).map(a => normalize(a));

    answer.disabled = true;

    if (possibleAnswers.includes(userVal)) {
        sessionCorrect++;
        result.textContent = "‚úÖ Dobrze!";
        result.className = "result good";
    } else {
        sessionWrong++;
        result.textContent = "‚ùå B≈ÇƒÖd! Poprawnie: " + correctRaw;
        result.className = "result bad";
        
        // Zapisz do b≈Çƒôd√≥w je≈õli jeszcze nie ma
        if (!wrong.some(w => w.en === current.en)) {
            wrong.push(current);
            localStorage.setItem("wrong", JSON.stringify(wrong));
            wrongCountText.textContent = wrong.length;
        }
    }

    updateStats();
    setTimeout(next, 1800);
}

function updateStats() {
    statCorrectText.textContent = sessionCorrect;
    statWrongText.textContent = sessionWrong;
    const completed = sessionCorrect + sessionWrong;
    progressText.textContent = `${completed} / ${initialPoolSize}`;
}

function finishGame() {
    question.textContent = "üéâ Koniec kategorii!";
    answer.style.display = "none";
    document.getElementById("checkBtn").style.display = "none";
    result.innerHTML = `Wynik ko≈Ñcowy: ${sessionCorrect} / ${initialPoolSize}<br>Skuteczno≈õƒá: ${Math.round((sessionCorrect/initialPoolSize)*100)}%`;
    result.className = "result good";
    
    setTimeout(() => {
        backToMenu();
        // Przywr√≥ƒá widoczno≈õƒá po powrocie
        answer.style.display = "block";
        document.getElementById("checkBtn").style.display = "block";
    }, 4000);
}

function backToMenu() {
    learn.style.display = "none";
    menu.style.display = "block";
}
</script>
</body>
</html>
