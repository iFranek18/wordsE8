<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>E8 CyberQuest: Ultimate Edition</title>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@900&family=Inter:wght@400;800&display=swap" rel="stylesheet">
    <style>
        :root { --p: #7289da; --neon: #00f2ff; --bg: #05050a; --card: rgba(25, 25, 45, 0.95); }
        body { margin:0; font-family: 'Inter', sans-serif; background: var(--bg); color: #fff; overflow: hidden; height: 100vh; }
        .rgb-bg { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; background: #000; }
        .line { position: absolute; width: 2px; height: 40vh; filter: blur(2px); animation: move linear infinite; opacity: 0.2; background: var(--neon); }
        @keyframes move { 0% { transform: translateY(-110%); } 100% { transform: translateY(110vh); } }
        .app { max-width: 480px; margin: 0 auto; padding: 15px; height: 100vh; display: flex; flex-direction: column; box-sizing: border-box; position: relative; }
        .hidden { display: none !important; }
        .modal { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: var(--card); border: 2px solid var(--neon); padding: 20px; border-radius: 20px; z-index: 100; width: 80%; max-width: 350px; }
        .overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 99; }
        .road-container { background: rgba(0,0,0,0.5); border-radius: 20px; border: 1px solid #333; margin-bottom: 10px; padding: 10px 0; }
        .road-scroll { display: flex; overflow-x: auto; gap: 15px; padding: 10px; scrollbar-width: none; }
        .node-box { width: 55px; height: 55px; background: var(--card); border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 1.3rem; border: 2px solid #444; }
        .unlocked .node-box { border-color: var(--neon); }
        .profile-card { background: var(--card); padding: 10px; border-radius: 18px; border: 1px solid var(--p); display: flex; align-items: center; gap: 10px; margin-bottom: 8px; }
        button { width: 100%; padding: 14px; border-radius: 12px; border: none; font-weight: 800; cursor: pointer; font-family: 'Orbitron'; text-transform: uppercase; margin-top: 5px; color: #fff; }
        .btn-blue { background: linear-gradient(135deg, #00d2ff, #3a7bd5); }
        .btn-check { background: linear-gradient(135deg, #00b894, #55efc4); margin-top: 15px; }
        input { width: 100%; padding: 12px; border-radius: 10px; border: 2px solid #333; background: #000; color: #fff; text-align: center; margin: 10px 0; }
        .grid-locker { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; }
        .locker-item { width: 50px; height: 50px; background: #111; border: 1px solid #333; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; cursor: pointer; }
        .locker-item.active { border-color: var(--neon); box-shadow: 0 0 10px var(--neon); }
        .dict-item { display: flex; justify-content: space-between; padding: 8px; border-bottom: 1px solid #222; font-size: 0.8rem; }
    </style>
</head>
<body>

<div class="rgb-bg" id="rgb-container"></div>

<div class="app" id="screen-menu">
    <div class="road-container"><div id="road-content" class="road-scroll"></div></div>
    <div class="profile-card">
        <div style="font-size:1.5rem; width:45px; height:45px; background:#111; border-radius:10px; display:flex; align-items:center; justify-content:center; border:2px solid var(--neon)" id="p-avatar">ğŸ‘¶ğŸ»</div>
        <div style="flex:1">
            <h2 id="p-name" style="margin:0; font-size:0.75rem; font-family:'Orbitron'">GRACZ</h2>
            <div style="font-size:0.6rem">ğŸ† <span id="p-cups">0</span> | ğŸ’° <span id="p-coins">0</span> | ğŸ’£ <span id="p-bombs">0</span></div>
        </div>
        <div onclick="toggleModal('modal-settings')" style="cursor:pointer; font-size:1.2rem">âš™ï¸</div>
    </div>
    <button class="btn-blue" onclick="startMode()">START NAUKA ğŸ“–</button>
    <button class="btn-blue" style="background:#6c5ce7" onclick="showScreen('screen-locker')">SZAFKA ğŸ‘•</button>
    <button class="btn-blue" style="background:#e67e22" onclick="showScreen('screen-shop')">SKLEP ğŸ’°</button>
    <div style="display:grid; grid-template-columns: 1fr 1fr; gap:8px">
        <button style="background:#2d3436" onclick="openDictionary()">SÅOWNIK</button>
        <button style="background:#1DB954; font-size:0.6rem" onclick="window.open('spotify:open','_blank')">SPOTIFY ğŸ§</button>
    </div>
    <div style="background:var(--card); border-radius:12px; padding:10px; margin-top:8px; flex:1; overflow-y:auto">
        <h4 style="margin:0 0 5px 0; font-family:'Orbitron'; font-size:0.6rem; color:var(--neon)">RANKING LIDERÃ“W</h4>
        <div id="leader-list"></div>
    </div>
</div>

<div class="app hidden" id="screen-dictionary">
    <button onclick="showScreen('screen-menu')">POWRÃ“T</button>
    <h3 style="font-family:'Orbitron'; text-align:center">TWOJE SÅÃ“WKA</h3>
    <div id="dict-list" style="overflow-y:auto; flex:1"></div>
</div>

<div class="app hidden" id="screen-locker">
    <button onclick="showScreen('screen-menu')">POWRÃ“T</button>
    <h2 style="font-family:'Orbitron'; text-align:center">SZAFKA</h2>
    <div id="locker-grid" class="grid-locker"></div>
</div>

<div class="app hidden" id="screen-shop">
    <button onclick="showScreen('screen-menu')">POWRÃ“T</button>
    <h2 style="font-family:'Orbitron'; text-align:center">MEGA SKLEP</h2>
    <div id="shop-items" style="overflow-y:auto; flex:1"></div>
</div>

<div class="app hidden" id="screen-game">
    <div style="display:flex; justify-content:space-between; color:var(--neon); font-size:0.7rem">
        <span id="g-level-info">ETAP 1</span>
        <span>POSTÄ˜P: <span id="g-progress">0/10</span></span>
    </div>
    <div id="g-word" style="font-size: 1.5rem; margin: 30px 0; text-align:center; font-family:'Orbitron'">SÅOWO</div>
    <input type="text" id="g-input" placeholder="TÅUMACZENIE..." autocomplete="off">
    <button class="btn-check" onclick="checkAnswer()">SPRAWDÅ¹ âœ…</button>
    <div id="g-feedback" style="margin: 10px 0; text-align:center; min-height:20px"></div>
    <button style="background:transparent; color:#555" onclick="exitGame()">WYJDÅ¹</button>
</div>

<div id="modal-settings" class="hidden">
    <div class="overlay" onclick="toggleModal('modal-settings')"></div>
    <div class="modal">
        <h3 style="font-family:'Orbitron'; margin:0">USTAWIENIA</h3>
        <input type="text" id="set-name-input" placeholder="WPISZ NICK">
        <button class="btn-blue" onclick="changeName()">ZAPISZ</button>
    </div>
</div>

<script>
const firebaseConfig = { apiKey: "AIzaSyCREz6ZMk86TW-dASBLNIHUTr5XDXZrTPE", authDomain: "english-game-d3ccd.firebaseapp.com", databaseURL: "https://english-game-d3ccd-default-rtdb.europe-west1.firebasedatabase.app", projectId: "english-game-d3ccd" };
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

const ALL_WORDS = {
    1: [{en:"I", pl:"ja"}, {en:"you", pl:"ty"}, {en:"he", pl:"on"}, {en:"she", pl:"ona"}, {en:"it", pl:"ono"}, {en:"we", pl:"my"}, {en:"they", pl:"oni"}],
    2: [{en:"what", pl:"co"}, {en:"where", pl:"gdzie"}, {en:"when", pl:"kiedy"}, {en:"why", pl:"dlaczego"}, {en:"how", pl:"jak"}],
    3: [{en:"mother", pl:"mama"}, {en:"father", pl:"tata"}, {en:"sister", pl:"siostra"}, {en:"brother", pl:"brat"}],
    4: [{en:"school", pl:"szkoÅ‚a"}, {en:"book", pl:"ksiÄ…Å¼ka"}, {en:"pen", pl:"dÅ‚ugopis"}, {en:"desk", pl:"biurko"}],
    5: [{en:"apple", pl:"jabÅ‚ko"}, {en:"water", pl:"woda"}, {en:"bread", pl:"chleb"}, {en:"cheese", pl:"ser"}]
};

const SHOP_ITEMS = [
    {id:'c1', n:'ZÅOTY NICK', p:500, type:'color', val:'#ffd700'},
    {id:'c2', n:'NEON BLUE', p:500, type:'color', val:'#00f2ff'},
    {id:'c3', n:'KRWISTA CZERWIEÅƒ', p:600, type:'color', val:'#ff4d4d'},
    {id:'c4', n:'MAGENTA', p:400, type:'color', val:'#ff00ff'},
    {id:'c5', n:'TRAWIASTY', p:300, type:'color', val:'#2ecc71'},
    {id:'e1', n:'NINJA', p:300, type:'emo', val:'ğŸ¥·'},
    {id:'e2', n:'KRÃ“L', p:1000, type:'emo', val:'ğŸ‘‘'},
    {id:'e3', n:'DUCH', p:200, type:'emo', val:'ğŸ‘»'},
    {id:'e4', n:'ROBOT', p:400, type:'emo', val:'ğŸ¤–'},
    {id:'e5', n:'KOSMITA', p:500, type:'emo', val:'ğŸ‘½'},
    {id:'e6', n:'CZASZKA', p:800, type:'emo', val:'ğŸ’€'},
    {id:'e7', n:'SMOK', p:1200, type:'emo', val:'ğŸ²'},
    {id:'e8', n:'DIAMENT', p:2000, type:'emo', val:'ğŸ’'},
    {id:'e9', n:'REKIN', p:600, type:'emo', val:'ğŸ¦ˆ'},
    {id:'e10', n:'WILK', p:700, type:'emo', val:'ğŸº'},
    {id:'e11', n:'OGIEÅƒ', p:300, type:'emo', val:'ğŸ”¥'},
    {id:'e12', n:'PANDA', p:400, type:'emo', val:'ğŸ¼'},
    {id:'e13', n:'TYGRYS', p:500, type:'emo', val:'ğŸ¯'},
    {id:'e14', n:'PIÅKA', p:200, type:'emo', val:'âš½'},
    {id:'e15', n:'GAMER', p:450, type:'emo', val:'ğŸ®'},
    {id:'e16', n:'MUZYKA', p:350, type:'emo', val:'ğŸ§'},
    {id:'e17', n:'PIENIÄ„DZE', p:1000, type:'emo', val:'ğŸ’°'},
    {id:'e18', n:'BÅYSKAWICA', p:600, type:'emo', val:'âš¡'},
    {id:'e19', n:'KOWBOJ', p:400, type:'emo', val:'ğŸ¤ '},
    {id:'e20', n:'WIKING', p:700, type:'emo', val:'ğŸª“'},
    {id:'e21', n:'MAÅPA', p:300, type:'emo', val:'ğŸµ'},
    {id:'e22', n:'KOT', p:250, type:'emo', val:'ğŸ±'},
    {id:'e23', n:'PIES', p:250, type:'emo', val:'ğŸ¶'},
    {id:'e24', n:'RAKIETA', p:900, type:'emo', val:'ğŸš€'},
    {id:'e25', n:'UNIKORN', p:1100, type:'emo', val:'ğŸ¦„'}
];

let user = JSON.parse(localStorage.getItem('e8_v3')) || {
    name: "GRACZ", avatar: "ğŸ‘¶ğŸ»", cups: 0, coins: 100, bombs: 3, 
    owned_emos: ['ğŸ‘¶ğŸ»'], owned_colors: ['#ffffff'], current_color: '#ffffff'
};
let game = { idx:0, pool:[], current:null };

function save() {
    localStorage.setItem('e8_v3', JSON.stringify(user));
    if(user.name !== "GRACZ") {
        db.ref('players/' + (localStorage.getItem('e8_uid') || 'u1')).set(user);
    }
    updateUI();
}

function updateUI() {
    document.getElementById('p-name').textContent = user.name;
    document.getElementById('p-name').style.color = user.current_color;
    document.getElementById('p-avatar').textContent = user.avatar;
    document.getElementById('p-cups').textContent = user.cups;
    document.getElementById('p-coins').textContent = user.coins;
    document.getElementById('p-bombs').textContent = user.bombs;
    renderLocker();
    renderShop();
    renderRoad();
}

function renderRoad() {
    let road = document.getElementById('road-content'); road.innerHTML = '';
    for(let i=0; i<=5000; i+=200) {
        road.innerHTML += `<div class="node ${user.cups>=i?'unlocked':''}"><div class="node-box">${i%1000==0?'ğŸ':'ğŸ’°'}</div><div style="font-size:0.5rem">${i}ğŸ†</div></div>`;
    }
}

function openDictionary() {
    let stage = Math.min(5, Math.floor(user.cups / 500) + 1);
    let list = document.getElementById('dict-list'); list.innerHTML = '';
    for(let i=1; i<=stage; i++) {
        ALL_WORDS[i].forEach(w => {
            list.innerHTML += `<div class="dict-item"><b>${w.en}</b><span>${w.pl}</span></div>`;
        });
    }
    showScreen('screen-dictionary');
}

function renderLocker() {
    document.getElementById('locker-grid').innerHTML = user.owned_emos.map(e => `
        <div class="locker-item ${user.avatar==e?'active':''}" onclick="user.avatar='${e}';save();">${e}</div>
    `).join('');
}

function renderShop() {
    document.getElementById('shop-items').innerHTML = SHOP_ITEMS.map(i => `
        <div class="profile-card" onclick="buyItem('${i.id}')">
            <div style="font-size:1.5rem">${i.type=='color'?'ğŸ¨':i.val}</div>
            <div style="flex:1"><b>${i.n}</b><br><small>${i.p} ğŸ’°</small></div>
        </div>
    `).join('');
}

function buyItem(id) {
    let i = SHOP_ITEMS.find(x => x.id == id);
    if(user.coins >= i.p) {
        user.coins -= i.p;
        if(i.type == 'color') { 
            if(!user.owned_colors.includes(i.val)) user.owned_colors.push(i.val);
            user.current_color = i.val;
        } else { if(!user.owned_emos.includes(i.val)) user.owned_emos.push(i.val); }
        save(); alert("ZAKUPIONO!");
    } else alert("BRAK MONET!");
}

function toggleModal(id) { document.getElementById(id).classList.toggle('hidden'); }
function changeName() {
    let n = document.getElementById('set-name-input').value;
    if(n && n.toUpperCase() !== "GRACZ") { user.name = n.toUpperCase(); save(); toggleModal('modal-settings'); }
}

function startMode() {
    let stage = Math.min(5, Math.floor(user.cups / 500) + 1);
    let words = []; for(let i=1; i<=stage; i++) words = [...words, ...ALL_WORDS[i]];
    game.pool = words.sort(() => 0.5 - Math.random()).slice(0, 10);
    game.idx = 0; showScreen('screen-game'); loadQ();
}

function loadQ() {
    game.current = game.pool[game.idx];
    game.dir = Math.random() > 0.5 ? 'en2pl' : 'pl2en';
    document.getElementById('g-word').textContent = (game.dir == 'en2pl' ? game.current.en : game.current.pl).toUpperCase();
    document.getElementById('g-input').value = ""; document.getElementById('g-feedback').textContent = "";
    document.getElementById('g-progress').textContent = (game.idx + 1) + "/10";
}

function checkAnswer() {
    let v = document.getElementById('g-input').value.toLowerCase().trim();
    let c = (game.dir == 'en2pl' ? game.current.pl : game.current.en).toLowerCase().trim();
    if(v == c || v.replace('Å‚','l') == c.replace('Å‚','l')) {
        game.idx++; user.coins += 10;
        if(game.idx >= 10) { user.cups += 50; exitGame(); alert("+50ğŸ†"); } else loadQ();
    } else { document.getElementById('g-feedback').textContent = "Å¹LE! POPRAWNIE: " + c.toUpperCase(); }
    save();
}

function exitGame() { showScreen('screen-menu'); }
function showScreen(id) { document.querySelectorAll('.app').forEach(s => s.classList.add('hidden')); document.getElementById(id).classList.remove('hidden'); }

db.ref('players').orderByChild('cups').limitToLast(10).on('value', snap => {
    let h = ''; snap.forEach(child => {
        let p = child.val();
        if(p.name !== "GRACZ") h = `<div style="font-size:0.7rem; color:${p.current_color}">${p.avatar} ${p.name} - ${p.cups}ğŸ†</div>` + h;
    });
    document.getElementById('leader-list').innerHTML = h;
});

if(!localStorage.getItem('e8_uid')) localStorage.setItem('e8_uid', 'u' + Date.now());
for(let i=0; i<15; i++) {
    let l = document.createElement('div'); l.className = 'line';
    l.style.left = Math.random()*100+'%'; l.style.animationDuration = (Math.random()*3+2)+'s';
    document.getElementById('rgb-container').appendChild(l);
}
save();
</script>
</body>
</html>
