<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>E8 CyberQuest: Mastery</title>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@900&family=Inter:wght@400;800&display=swap" rel="stylesheet">
    <style>
        :root { --p: #7289da; --neon: #00f2ff; --bg: #05050a; --card: rgba(25, 25, 45, 0.95); }
        body { margin:0; font-family: 'Inter', sans-serif; background: var(--bg); color: #fff; overflow: hidden; height: 100vh; }
        .rgb-bg { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; background: #000; overflow: hidden; }
        .line { position: absolute; width: 2px; height: 40vh; filter: blur(2px); animation: move linear infinite; opacity: 0.2; }
        @keyframes move { 0% { transform: translateY(-110%) rotate(5deg); } 100% { transform: translateY(110vh) rotate(5deg); } }

        .app { max-width: 480px; margin: 0 auto; padding: 15px; height: 100vh; display: flex; flex-direction: column; box-sizing: border-box; }
        .hidden { display: none !important; }

        /* ROAD */
        .road-container { background: rgba(0,0,0,0.5); border-radius: 20px; border: 1px solid #333; margin-bottom: 10px; padding: 10px 0; }
        .road-scroll { display: flex; overflow-x: auto; gap: 15px; padding: 10px; scrollbar-width: none; }
        .node { flex: 0 0 65px; text-align: center; cursor: pointer; }
        .node-box { width: 55px; height: 55px; background: var(--card); border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 1.3rem; border: 2px solid #444; margin-bottom: 4px; }
        .unlocked .node-box { border-color: var(--neon); box-shadow: 0 0 8px var(--neon); }
        .claimed { opacity: 0.4; filter: grayscale(1); }

        /* UI */
        .profile-card { background: var(--card); padding: 10px; border-radius: 18px; border: 1px solid var(--p); display: flex; align-items: center; gap: 10px; margin-bottom: 8px; }
        button { width: 100%; padding: 14px; border-radius: 12px; border: none; font-weight: 800; cursor: pointer; font-family: 'Orbitron'; text-transform: uppercase; margin-top: 5px; }
        .btn-blue { background: linear-gradient(135deg, #00d2ff, #3a7bd5); color: white; }
        .btn-check { background: linear-gradient(135deg, #00b894, #55efc4); color: white; font-size: 1.2rem; margin-top: 15px; box-shadow: 0 4px 15px rgba(0,184,148,0.4); }
        .btn-ranked { background: linear-gradient(135deg, #ff416c, #ff4b2b); color: white; }
        .btn-spotify { background: #1DB954; color: white; font-size: 0.6rem; padding: 8px; }

        input { width: 100%; padding: 16px; border-radius: 12px; border: 2px solid #333; background: #000; color: var(--neon); font-size: 1.1rem; text-align: center; font-family: 'Orbitron'; box-sizing: border-box; }
        .pill { padding: 8px 12px; background: #1a1a2e; border: 1px solid var(--p); border-radius: 8px; margin: 3px; cursor: pointer; font-size: 0.8rem; display: inline-block; }
        
        #dict-list { overflow-y: auto; flex: 1; }
        .dict-item { padding: 8px; border-bottom: 1px solid #222; font-size: 0.9rem; display: flex; justify-content: space-between; }
    </style>
</head>
<body>

<div class="rgb-bg" id="rgb-container"></div>

<div class="app" id="screen-menu">
    <div class="road-container">
        <div id="road-content" class="road-scroll"></div>
    </div>

    <div class="profile-card">
        <div style="font-size:1.5rem; width:45px; height:45px; background:#111; border-radius:10px; display:flex; align-items:center; justify-content:center; border:2px solid var(--neon)" id="p-avatar">ğŸ‘¶ğŸ»</div>
        <div style="flex:1">
            <h2 id="p-name" style="margin:0; font-size:0.75rem; font-family:'Orbitron'">GRACZ</h2>
            <div style="font-size:0.65rem">ğŸ† <span id="p-cups">0</span> | ğŸ’° <span id="p-coins">0</span> | ğŸ’£ <span id="p-bombs">0</span> <span id="p-x2" style="color:yellow; display:none">x2!</span></div>
        </div>
        <div onclick="showScreen('screen-settings')" style="cursor:pointer">âš™ï¸</div>
    </div>

    <button class="btn-blue" onclick="startMode('words')">SÅÃ“WKA E8 ğŸ“–</button>
    <button class="btn-blue" style="background:#6c5ce7" onclick="startMode('sentences')">UKÅADANIE ZDAÅƒ ğŸ§©</button>
    <button class="btn-ranked" onclick="startMode('ranked')">MECZ RANKINGOWY âš”ï¸</button>
    
    <div style="display:grid; grid-template-columns: 1fr 1fr; gap:8px">
        <button style="background:#2d3436; color:white" onclick="openDictionary()">SÅOWNIK</button>
        <button style="background:#e67e22; color:white" onclick="showScreen('screen-shop')">SKLEP</button>
    </div>

    <button class="btn-spotify" onclick="window.open('spotify:open', '_blank')">ODPALAJ SPOTIFY ğŸ§</button>

    <div style="background:var(--card); border-radius:12px; padding:10px; margin-top:8px; flex:1; overflow-y:auto">
        <h4 style="margin:0 0 5px 0; font-family:'Orbitron'; font-size:0.6rem; color:var(--neon)">TABELA LIDERÃ“W</h4>
        <div id="leader-list"></div>
    </div>
</div>

<div class="app hidden" id="screen-game">
    <div style="display:flex; justify-content:space-between; color:var(--neon); font-family:'Orbitron'; font-size:0.7rem">
        <span id="g-level-info">ETAP 1</span>
        <span>POSTÄ˜P: <span id="g-progress">0/10</span></span>
    </div>
    <div id="g-word" style="font-size: 1.5rem; margin: 25px 0; font-weight:900; text-align:center; font-family:'Orbitron'; color:var(--neon)">SÅOWO</div>
    <div id="sentence-box" style="margin-bottom: 15px; text-align:center; min-height:40px"></div>
    <input type="text" id="g-input" placeholder="WPISZ TÅUMACZENIE..." autocomplete="off">
    
    <button class="btn-check" onclick="checkAnswer()">SPRAWDÅ¹ âœ…</button>
    
    <div id="g-feedback" style="margin: 10px 0; text-align:center; font-weight:bold; min-height:20px"></div>
    <button class="btn-blue" style="background:#f1c40f; color:#000; padding:10px" onclick="useBomb()">POMOC ğŸ’£</button>
    <button style="background:transparent; color:#555; padding:5px" onclick="exitGame()">WYJDÅ¹</button>
</div>

<div class="app hidden" id="screen-shop" style="overflow-y:auto">
    <button onclick="showScreen('screen-menu')">POWRÃ“T</button>
    <h2 style="font-family:'Orbitron'; text-align:center">SKLEP ğŸ’°</h2>
    <div id="shop-items" style="display:grid; grid-template-columns: 1fr 1fr; gap:10px"></div>
</div>

<div class="app hidden" id="screen-dictionary">
    <button onclick="showScreen('screen-menu')">POWRÃ“T</button>
    <h3 style="font-family:'Orbitron'; text-align:center" id="dict-title">SÅOWNIK ETAP 1</h3>
    <div id="dict-list"></div>
</div>

<script>
// --- FIREBASE ---
const firebaseConfig = { apiKey: "AIzaSyCREz6ZMk86TW-dASBLNIHUTr5XDXZrTPE", authDomain: "english-game-d3ccd.firebaseapp.com", databaseURL: "https://english-game-d3ccd-default-rtdb.europe-west1.firebasedatabase.app", projectId: "english-game-d3ccd" };
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// --- BAZA SÅÃ“WEK ---
const STAGE_WORDS = {
    1: [
        {en:"I", pl:"ja"}, {en:"you", pl:"ty"}, {en:"he", pl:"on"}, {en:"she", pl:"ona"}, {en:"it", pl:"ono"}, {en:"we", pl:"my"}, {en:"they", pl:"oni"},
        {en:"mother", pl:"mama"}, {en:"father", pl:"tata"}, {en:"sister", pl:"siostra"}, {en:"brother", pl:"brat"}, {en:"school", pl:"szkoÅ‚a"},
        {en:"dog", pl:"pies"}, {en:"cat", pl:"kot"}, {en:"apple", pl:"jabÅ‚ko"}, {en:"water", pl:"woda"}, {en:"book", pl:"ksiÄ…Å¼ka"}
    ],
    2: [
        {en:"my", pl:"mÃ³j"}, {en:"your", pl:"twÃ³j"}, {en:"his", pl:"jego"}, {en:"our", pl:"nasz"}, {en:"their", pl:"ich"},
        {en:"what", pl:"co"}, {en:"where", pl:"gdzie"}, {en:"when", pl:"kiedy"}, {en:"why", pl:"dlaczego"},
        {en:"teacher", pl:"nauczyciel"}, {en:"doctor", pl:"lekarz"}, {en:"nurse", pl:"pielÄ™gniarka"}, {en:"house", pl:"dom"},
        {en:"kitchen", pl:"kuchnia"}, {en:"milk", pl:"mleko"}, {en:"bread", pl:"chleb"}
    ],
    3: [
        {en:"between", pl:"miÄ™dzy"}, {en:"behind", pl:"za"}, {en:"under", pl:"pod"}, {en:"always", pl:"zawsze"}, {en:"never", pl:"nigdy"},
        {en:"beautiful", pl:"piÄ™kny"}, {en:"cheap", pl:"tani"}, {en:"expensive", pl:"drogi"}, {en:"important", pl:"waÅ¼ny"},
        {en:"understand", pl:"rozumieÄ‡"}, {en:"remember", pl:"pamiÄ™taÄ‡"}, {en:"weather", pl:"pogoda"}
    ],
    4: [
        {en:"although", pl:"chociaÅ¼"}, {en:"usually", pl:"zazwyczaj"}, {en:"sometimes", pl:"czasami"},
        {en:"description", pl:"opis"}, {en:"success", pl:"sukces"}, {en:"failure", pl:"poraÅ¼ka"},
        {en:"engineer", pl:"inÅ¼ynier"}, {en:"neighbor", pl:"sÄ…siad"}, {en:"government", pl:"rzÄ…d"}
    ],
    5: [
        {en:"protection", pl:"ochrona"}, {en:"environment", pl:"Å›rodowisko"}, {en:"situation", pl:"sytuacja"},
        {en:"irregular", pl:"nieregularny"}, {en:"thought", pl:"myÅ›l"}, {en:"achieve", pl:"osiÄ…gnÄ…Ä‡"}
    ]
};

// --- ROAD GENERATOR ---
const ROAD_MAP = [];
for(let i=0; i<=5000; i+= (i<1000?100: (i<3000?250:500))) {
    let type = i % 200 === 0 ? 'ğŸ’°' : 'ğŸ’£';
    if(i % 1000 === 0) type = 'ğŸ‘‘';
    ROAD_MAP.push({cups: i, v: type});
}

// --- STATE ---
let user = JSON.parse(localStorage.getItem('e8_master_v1')) || {
    name: "GRACZ", avatar: "ğŸ‘¶ğŸ»", cups: 0, coins: 50, bombs: 2, claimed: [], mult: 1
};
let game = { idx: 0, pool: [], currentQ: null };

function save() {
    localStorage.setItem('e8_master_v1', JSON.stringify(user));
    db.ref('players/'+(localStorage.getItem('e8_id')||'u1')).set({name:user.name, cups:user.cups, avatar:user.avatar});
    updateUI();
}

function updateUI() {
    document.getElementById('p-name').textContent = user.name;
    document.getElementById('p-cups').textContent = user.cups;
    document.getElementById('p-coins').textContent = user.coins;
    document.getElementById('p-bombs').textContent = user.bombs;
    renderRoad();
}

function renderRoad() {
    const road = document.getElementById('road-content');
    road.innerHTML = ROAD_MAP.map(n => `
        <div class="node ${user.cups >= n.cups ? 'unlocked' : ''} ${user.claimed.includes(n.cups) ? 'claimed' : ''}" onclick="claim(${n.cups})">
            <div class="node-box">${n.v}</div>
            <div style="font-size:0.5rem">${n.cups}ğŸ†</div>
        </div>
    `).join('');
}

function claim(c) {
    if(user.cups >= c && !user.claimed.includes(c)) {
        user.coins += 100; user.claimed.push(c); save();
    }
}

function getStage() {
    if(user.cups < 500) return 1;
    if(user.cups < 1500) return 2;
    if(user.cups < 3000) return 3;
    if(user.cups < 4500) return 4;
    return 5;
}

function startMode(m) {
    const stage = getStage();
    let words = [];
    for(let i=1; i<=stage; i++) words = [...words, ...STAGE_WORDS[i]];
    
    game.idx = 0;
    game.pool = words.sort(() => 0.5 - Math.random()).slice(0, 10);
    game.mode = m;
    showScreen('screen-game');
    document.getElementById('g-level-info').textContent = "ETAP " + stage;
    loadQ();
}

function loadQ() {
    game.currentQ = game.pool[game.idx];
    game.dir = Math.random() > 0.5 ? 'en2pl' : 'pl2en';
    document.getElementById('g-word').textContent = (game.dir === 'en2pl' ? game.currentQ.en : game.currentQ.pl).toUpperCase();
    document.getElementById('g-input').value = "";
    document.getElementById('g-feedback').textContent = "";
    document.getElementById('g-progress').textContent = `${game.idx+1}/10`;
    
    const sBox = document.getElementById('sentence-box');
    sBox.innerHTML = "";
    if(game.mode === 'sentences') {
        let parts = (game.dir === 'en2pl' ? game.currentQ.pl : game.currentQ.en).split(' ');
        parts.sort(() => 0.5 - Math.random()).forEach(p => {
            sBox.innerHTML += `<span class="pill" onclick="document.getElementById('g-input').value += '${p} '">${p}</span>`;
        });
    }
}

function checkAnswer() {
    const val = document.getElementById('g-input').value.toLowerCase().trim();
    const correct = (game.dir === 'en2pl' ? game.currentQ.pl : game.currentQ.en).toLowerCase().trim();
    
    if(val === correct || val.replace('Å‚','l') === correct.replace('Å‚','l')) {
        user.coins += 10; game.idx++;
        if(game.idx >= 10) {
            user.cups += 50; exitGame(); alert("WYGRANA! +50 ğŸ†");
        } else loadQ();
    } else {
        document.getElementById('g-feedback').textContent = "BÅÄ„D! POPRAWNIE: " + correct.toUpperCase();
        document.getElementById('g-feedback').style.color = "#ff416c";
    }
    save();
}

function openDictionary() {
    const stage = getStage();
    document.getElementById('dict-title').textContent = "SÅOWNIK ETAP " + stage;
    let words = [];
    for(let i=1; i<=stage; i++) words = [...words, ...STAGE_WORDS[i]];
    document.getElementById('dict-list').innerHTML = words.map(w => `<div class="dict-item"><b>${w.en}</b> <span>${w.pl}</span></div>`).join('');
    showScreen('screen-dictionary');
}

function useBomb() {
    if(user.bombs > 0) {
        user.bombs--;
        const correct = (game.dir === 'en2pl' ? game.currentQ.pl : game.currentQ.en);
        alert("PIERWSZA LITERA: " + correct[0].toUpperCase());
        save();
    }
}

function exitGame() { showScreen('screen-menu'); }
function showScreen(id) { document.querySelectorAll('.app').forEach(s => s.classList.add('hidden')); document.getElementById(id).classList.remove('hidden'); }

// SKLEP
const SHOP = [ {n:'1 BOMBA', p:50, v:'ğŸ’£'}, {n:'5 BOMB', p:200, v:'ğŸ’£5'}, {n:'NINJA', p:1000, v:'ğŸ¥·'} ];
document.getElementById('shop-items').innerHTML = SHOP.map(i => `
    <div style="background:var(--card); padding:10px; border-radius:10px; text-align:center" onclick="buy('${i.n}', ${i.p}, '${i.v}')">
        <div>${i.v}</div><small>${i.n}</small><br><b style="color:var(--neon)">${i.p}ğŸ’°</b>
    </div>
`).join('');

function buy(n,p,v) {
    if(user.coins >= p) {
        user.coins -= p;
        if(v.includes('ğŸ’£')) user.bombs += (v==='ğŸ’£5'?5:1);
        else user.avatar = v;
        save();
    }
}

// RANKING
db.ref('players').orderByChild('cups').limitToLast(5).on('value', s => {
    let l = []; s.forEach(x => l.push(x.val()));
    document.getElementById('leader-list').innerHTML = l.reverse().map(p => `<div style="font-size:0.6rem; margin-bottom:3px">${p.avatar} ${p.name} - ${p.cups}ğŸ†</div>`).join('');
});

// START
if(!localStorage.getItem('e8_id')) localStorage.setItem('e8_id', 'u'+Date.now());
const c = document.getElementById('rgb-container');
for(let i=0; i<8; i++){ let l=document.createElement('div'); l.className='line'; l.style.left=Math.random()*100+'%'; l.style.background='linear-gradient(to bottom, transparent, #00f2ff, transparent)'; l.style.animationDuration=(Math.random()*3+2)+'s'; c.appendChild(l); }
save();
</script>
</body>
</html>
