<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>E8 CyberQuest: Ultimate Edition</title>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@900&family=Inter:wght@400;800&display=swap" rel="stylesheet">
    <style>
        :root { --p: #7289da; --neon: #00f2ff; --bg: #05050a; --card: rgba(25, 25, 45, 0.95); }
        body { margin:0; font-family: 'Inter', sans-serif; background: var(--bg); color: #fff; overflow: hidden; height: 100vh; }
        .rgb-bg { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; background: #000; }
        .line { position: absolute; width: 2px; height: 40vh; filter: blur(2px); animation: move linear infinite; opacity: 0.2; background: var(--neon); }
        @keyframes move { 0% { transform: translateY(-110%); } 100% { transform: translateY(110vh); } }

        .app { max-width: 480px; margin: 0 auto; padding: 15px; height: 100vh; display: flex; flex-direction: column; box-sizing: border-box; position: relative; }
        .hidden { display: none !important; }

        /* MODALE / OKNA */
        .modal { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: var(--card); border: 2px solid var(--neon); padding: 20px; border-radius: 20px; z-index: 100; width: 80%; max-width: 350px; box-shadow: 0 0 30px rgba(0,242,255,0.3); }
        .overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 99; }

        /* UI ELEMENTS */
        .road-container { background: rgba(0,0,0,0.5); border-radius: 20px; border: 1px solid #333; margin-bottom: 10px; padding: 10px 0; }
        .road-scroll { display: flex; overflow-x: auto; gap: 15px; padding: 10px; scrollbar-width: none; }
        .node-box { width: 55px; height: 55px; background: var(--card); border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 1.3rem; border: 2px solid #444; margin-bottom: 4px; position: relative; }
        .unlocked .node-box { border-color: var(--neon); }

        .profile-card { background: var(--card); padding: 10px; border-radius: 18px; border: 1px solid var(--p); display: flex; align-items: center; gap: 10px; margin-bottom: 8px; }
        button { width: 100%; padding: 14px; border-radius: 12px; border: none; font-weight: 800; cursor: pointer; font-family: 'Orbitron'; text-transform: uppercase; margin-top: 5px; color: #fff; }
        .btn-blue { background: linear-gradient(135deg, #00d2ff, #3a7bd5); }
        .btn-check { background: linear-gradient(135deg, #00b894, #55efc4); margin-top: 15px; }
        
        input { width: 100%; padding: 12px; border-radius: 10px; border: 2px solid #333; background: #000; color: #fff; text-align: center; margin: 10px 0; }
        
        .grid-locker { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-top: 15px; }
        .locker-item { width: 50px; height: 50px; background: #111; border: 1px solid #333; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; cursor: pointer; }
        .locker-item.active { border-color: var(--neon); box-shadow: 0 0 10px var(--neon); }
    </style>
</head>
<body>

<div class="rgb-bg" id="rgb-container"></div>

<div class="app" id="screen-menu">
    <div class="road-container"><div id="road-content" class="road-scroll"></div></div>

    <div class="profile-card">
        <div style="font-size:1.5rem; width:45px; height:45px; background:#111; border-radius:10px; display:flex; align-items:center; justify-content:center; border:2px solid var(--neon)" id="p-avatar">üë∂üèª</div>
        <div style="flex:1">
            <h2 id="p-name" style="margin:0; font-size:0.75rem; font-family:'Orbitron'">GRACZ</h2>
            <div style="font-size:0.6rem">üèÜ <span id="p-cups">0</span> | üí∞ <span id="p-coins">0</span> | üí£ <span id="p-bombs">0</span></div>
        </div>
        <div onclick="toggleModal('modal-settings')" style="cursor:pointer; font-size:1.2rem">‚öôÔ∏è</div>
    </div>

    <button class="btn-blue" onclick="startMode('words')">START NAUKA üìñ</button>
    <button class="btn-blue" style="background:#6c5ce7" onclick="showScreen('screen-locker')">SZAFKA / EMOTKI üëï</button>
    <button class="btn-blue" style="background:#e67e22" onclick="showScreen('screen-shop')">SKLEP üí∞</button>
    
    <div style="display:grid; grid-template-columns: 1fr 1fr; gap:8px">
        <button style="background:#2d3436" onclick="openDictionary()">S≈ÅOWNIK</button>
        <button style="background:#1DB954; font-size:0.6rem" onclick="window.open('spotify:open','_blank')">SPOTIFY üéß</button>
    </div>

    <div style="background:var(--card); border-radius:12px; padding:10px; margin-top:8px; flex:1; overflow-y:auto">
        <h4 style="margin:0 0 5px 0; font-family:'Orbitron'; font-size:0.6rem; color:var(--neon)">RANKING LIDER√ìW</h4>
        <div id="leader-list"></div>
    </div>
</div>

<div class="app hidden" id="screen-locker">
    <button onclick="showScreen('screen-menu')">POWR√ìT</button>
    <h2 style="font-family:'Orbitron'; text-align:center">TWOJA SZAFKA</h2>
    <div id="locker-grid" class="grid-locker"></div>
</div>

<div class="app hidden" id="screen-shop">
    <button onclick="showScreen('screen-menu')">POWR√ìT</button>
    <h2 style="font-family:'Orbitron'; text-align:center">SKLEP</h2>
    <div id="shop-items" style="overflow-y:auto; flex:1"></div>
</div>

<div class="app hidden" id="screen-game">
    <div style="display:flex; justify-content:space-between; color:var(--neon); font-family:'Orbitron'; font-size:0.7rem">
        <span id="g-level-info">ETAP 1</span>
        <span>POSTƒòP: <span id="g-progress">0/10</span></span>
    </div>
    <div id="g-word" style="font-size: 1.5rem; margin: 30px 0; text-align:center; font-family:'Orbitron'">S≈ÅOWO</div>
    <input type="text" id="g-input" placeholder="T≈ÅUMACZENIE..." autocomplete="off">
    <button class="btn-check" onclick="checkAnswer()">SPRAWD≈π ‚úÖ</button>
    <div id="g-feedback" style="margin: 10px 0; text-align:center; min-height:20px"></div>
    <button style="background:transparent; color:#555" onclick="exitGame()">WYJD≈π</button>
</div>

<div id="modal-settings" class="hidden">
    <div class="overlay" onclick="toggleModal('modal-settings')"></div>
    <div class="modal">
        <h3 style="font-family:'Orbitron'; margin:0">USTAWIENIA</h3>
        <input type="text" id="set-name-input" placeholder="NOWY NICK">
        <button class="btn-blue" onclick="changeName()">ZAPISZ</button>
    </div>
</div>

<script>
// --- KONFIGURACJA ---
const firebaseConfig = { apiKey: "AIzaSyCREz6ZMk86TW-dASBLNIHUTr5XDXZrTPE", authDomain: "english-game-d3ccd.firebaseapp.com", databaseURL: "https://english-game-d3ccd-default-rtdb.europe-west1.firebasedatabase.app", projectId: "english-game-d3ccd" };
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// --- S≈Å√ìWKA ---
const ALL_WORDS = {
    1: [
        {en:"I", pl:"ja"}, {en:"you", pl:"ty"}, {en:"he", pl:"on"}, {en:"she", pl:"ona"}, {en:"it", pl:"ono"}, {en:"we", pl:"my"}, {en:"they", pl:"oni"},
        {en:"me", pl:"mnie"}, {en:"him", pl:"jego"}, {en:"her", pl:"jej"}, {en:"us", pl:"nas"}, {en:"them", pl:"ich"},
        {en:"mother", pl:"mama"}, {en:"father", pl:"tata"}, {en:"parents", pl:"rodzice"}, {en:"sister", pl:"siostra"}, {en:"brother", pl:"brat"},
        {en:"grandmother", pl:"babcia"}, {en:"grandfather", pl:"dziadek"}, {en:"friend", pl:"przyjaciel"}, {en:"baby", pl:"niemowle"}
    ],
    2: [
        {en:"what", pl:"co"}, {en:"who", pl:"kto"}, {en:"where", pl:"gdzie"}, {en:"when", pl:"kiedy"}, {en:"why", pl:"dlaczego"}, {en:"how", pl:"jak"},
        {en:"in", pl:"w"}, {en:"on", pl:"na"}, {en:"at", pl:"przy"}, {en:"to", pl:"do"}, {en:"with", pl:"z"}, {en:"about", pl:"o"},
        {en:"school", pl:"szko≈Ça"}, {en:"exam", pl:"egzamin"}, {en:"homework", pl:"praca domowa"}, {en:"book", pl:"ksiƒÖ≈ºka"}, {en:"pen", pl:"d≈Çugopis"}
    ],
    3: [
        {en:"English", pl:"angielski"}, {en:"maths", pl:"matematyka"}, {en:"history", pl:"historia"},
        {en:"teacher", pl:"nauczyciel"}, {en:"doctor", pl:"lekarz"}, {en:"nurse", pl:"pielƒôgniarka"}, {en:"police officer", pl:"policjant"},
        {en:"house", pl:"dom"}, {en:"flat", pl:"mieszkanie"}, {en:"kitchen", pl:"kuchnia"}, {en:"bathroom", pl:"≈Çazienka"}, {en:"door", pl:"drzwi"}
    ],
    4: [
        {en:"table", pl:"st√≥≈Ç"}, {en:"bed", pl:"≈Ç√≥≈ºko"}, {en:"mirror", pl:"lustro"}, {en:"phone", pl:"telefon"}, {en:"computer", pl:"komputer"},
        {en:"bread", pl:"chleb"}, {en:"butter", pl:"mas≈Ço"}, {en:"cheese", pl:"ser"}, {en:"apple", pl:"jab≈Çko"}, {en:"water", pl:"woda"},
        {en:"dog", pl:"pies"}, {en:"cat", pl:"kot"}, {en:"bird", pl:"ptak"}, {en:"lion", pl:"lew"}
    ],
    5: [
        {en:"city", pl:"miasto"}, {en:"street", pl:"ulica"}, {en:"shop", pl:"sklep"}, {en:"restaurant", pl:"restauracja"},
        {en:"car", pl:"samoch√≥d"}, {en:"bus", pl:"autobus"}, {en:"train", pl:"pociƒÖg"}, {en:"plane", pl:"samolot"},
        {en:"time", pl:"czas"}, {en:"day", pl:"dzie≈Ñ"}, {en:"week", pl:"tydzie≈Ñ"}, {en:"morning", pl:"rano"}, {en:"night", pl:"noc"}
    ]
};

// --- SKLEP ---
const SHOP_ITEMS = [
    {id:'nick_gold', n:'Z≈ÅOTY NICK', p:1000, type:'color', val:'#ffd700'},
    {id:'nick_neon', n:'NEONOWY NICK', p:1500, type:'color', val:'#00f2ff'},
    {id:'nick_pink', n:'R√ì≈ªOWY NICK', p:800, type:'color', val:'#ff00ff'},
    {id:'emo_ninja', n:'EMOTKA NINJA', p:500, type:'emo', val:'ü•∑'},
    {id:'emo_king', n:'EMOTKA KR√ìL', p:2000, type:'emo', val:'üëë'},
    {id:'emo_ghost', n:'EMOTKA DUCH', p:600, type:'emo', val:'üëª'},
    {id:'emo_alien', n:'EMOTKA KOSMITA', p:700, type:'emo', val:'üëΩ'},
    {id:'emo_robot', n:'EMOTKA ROBOT', p:900, type:'emo', val:'ü§ñ'}
];

// --- LOGIKA ---
let user = JSON.parse(localStorage.getItem('e8_v2')) || {
    name: "GRACZ", avatar: "üë∂üèª", cups: 0, coins: 100, bombs: 3, 
    owned_emos: ['üë∂üèª'], owned_colors: ['#ffffff'], current_color: '#ffffff'
};
let game = { idx:0, pool:[], current:null };

function save() {
    localStorage.setItem('e8_v2', JSON.stringify(user));
    db.ref('players/' + (localStorage.getItem('e8_uid') || 'u1')).set(user);
    updateUI();
}

function updateUI() {
    document.getElementById('p-name').textContent = user.name;
    document.getElementById('p-name').style.color = user.current_color;
    document.getElementById('p-avatar').textContent = user.avatar;
    document.getElementById('p-cups').textContent = user.cups;
    document.getElementById('p-coins').textContent = user.coins;
    document.getElementById('p-bombs').textContent = user.bombs;
    renderLocker();
    renderShop();
    renderRoad();
}

function renderRoad() {
    let road = document.getElementById('road-content');
    road.innerHTML = '';
    for(let i=0; i<=5000; i+=200) {
        road.innerHTML += `<div class="node ${user.cups>=i?'unlocked':''}"><div class="node-box">${i%1000==0?'üéÅ':'üí∞'}</div><div style="font-size:0.5rem">${i}üèÜ</div></div>`;
    }
}

function renderLocker() {
    let grid = document.getElementById('locker-grid');
    grid.innerHTML = user.owned_emos.map(e => `
        <div class="locker-item ${user.avatar==e?'active':''}" onclick="setAvatar('${e}')">${e}</div>
    `).join('');
}

function setAvatar(e) { user.avatar = e; save(); }

function renderShop() {
    let container = document.getElementById('shop-items');
    container.innerHTML = SHOP_ITEMS.map(item => `
        <div class="profile-card" onclick="buyItem('${item.id}')">
            <div style="font-size:1.5rem">${item.type=='color'?'üé®':item.val}</div>
            <div style="flex:1"><b>${item.n}</b><br><small>${item.p} üí∞</small></div>
        </div>
    `).join('');
}

function buyItem(id) {
    let item = SHOP_ITEMS.find(x => x.id == id);
    if(user.coins >= item.p) {
        user.coins -= item.p;
        if(item.type == 'color') {
            if(!user.owned_colors.includes(item.val)) user.owned_colors.push(item.val);
            user.current_color = item.val;
        } else {
            if(!user.owned_emos.includes(item.val)) user.owned_emos.push(item.val);
        }
        save();
        alert("ZAKUPIONO!");
    } else alert("ZA MA≈ÅO KASY!");
}

function toggleModal(id) { document.getElementById(id).classList.toggle('hidden'); }

function changeName() {
    let newName = document.getElementById('set-name-input').value;
    if(newName) { user.name = newName.toUpperCase(); save(); toggleModal('modal-settings'); }
}

function startMode(m) {
    let stage = Math.min(5, Math.floor(user.cups / 500) + 1);
    let words = [];
    for(let i=1; i<=stage; i++) words = [...words, ...ALL_WORDS[i]];
    game.pool = words.sort(() => 0.5 - Math.random()).slice(0, 10);
    game.idx = 0;
    showScreen('screen-game');
    document.getElementById('g-level-info').textContent = "ETAP " + stage;
    loadQ();
}

function loadQ() {
    game.current = game.pool[game.idx];
    game.dir = Math.random() > 0.5 ? 'en2pl' : 'pl2en';
    document.getElementById('g-word').textContent = (game.dir == 'en2pl' ? game.current.en : game.current.pl).toUpperCase();
    document.getElementById('g-input').value = "";
    document.getElementById('g-feedback').textContent = "";
    document.getElementById('g-progress').textContent = (game.idx + 1) + "/10";
}

function checkAnswer() {
    let val = document.getElementById('g-input').value.toLowerCase().trim();
    let correct = (game.dir == 'en2pl' ? game.current.pl : game.current.en).toLowerCase().trim();
    if(val == correct || val.replace('≈Ç','l') == correct.replace('≈Ç','l')) {
        game.idx++;
        user.coins += 10;
        if(game.idx >= 10) { user.cups += 50; exitGame(); alert("KONIEC ETAPU! +50üèÜ"); } else loadQ();
    } else {
        document.getElementById('g-feedback').textContent = "≈πLE! POPRAWNIE: " + correct.toUpperCase();
        document.getElementById('g-feedback').style.color = "red";
    }
    save();
}

function exitGame() { showScreen('screen-menu'); }
function showScreen(id) { document.querySelectorAll('.app').forEach(s => s.classList.add('hidden')); document.getElementById(id).classList.remove('hidden'); }

// RANKING
db.ref('players').orderByChild('cups').limitToLast(10).on('value', snap => {
    let html = '';
    snap.forEach(child => {
        let p = child.val();
        html = `<div style="font-size:0.7rem; color:${p.current_color || '#fff'}">${p.avatar} ${p.name} - ${p.cups}üèÜ</div>` + html;
    });
    document.getElementById('leader-list').innerHTML = html;
});

// INIT
if(!localStorage.getItem('e8_uid')) localStorage.setItem('e8_uid', 'u' + Date.now());
for(let i=0; i<15; i++) {
    let l = document.createElement('div'); l.className = 'line';
    l.style.left = Math.random()*100+'%'; l.style.animationDuration = (Math.random()*3+2)+'s';
    document.getElementById('rgb-container').appendChild(l);
}
save();
</script>
</body>
</html>
