<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>E8 CyberQuest: Legend Edition</title>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700;900&family=Inter:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root { --neon: #00f2ff; --bg: #05050a; --card: rgba(15, 15, 30, 0.95); }
        body { margin:0; font-family: 'Inter', sans-serif; background: var(--bg); color: #fff; overflow: hidden; height: 100vh; }
        .rgb-bg { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; background: #000; opacity: 0.4; }
        .app { max-width: 480px; margin: 0 auto; padding: 15px; height: 100vh; display: flex; flex-direction: column; box-sizing: border-box; }
        .hidden { display: none !important; }
        
        /* OÅ› postÄ™pu */
        .road { display: flex; overflow-x: auto; gap: 20px; padding: 10px; background: rgba(0,0,0,0.4); border-radius: 15px; scrollbar-width: none; border: 1px solid #333; margin-bottom: 10px; }
        .node { min-width: 70px; text-align: center; position: relative; }
        .node-circle { width: 40px; height: 40px; background: #222; border-radius: 50%; margin: 0 auto 5px; border: 2px solid #444; display: flex; align-items: center; justify-content: center; }
        .unlocked .node-circle { border-color: var(--neon); box-shadow: 0 0 10px var(--neon); color: var(--neon); }

        .profile-card { background: var(--card); padding: 15px; border-radius: 20px; border: 1px solid #333; display: flex; align-items: center; gap: 15px; margin-bottom: 10px; }
        button { width: 100%; padding: 14px; border-radius: 12px; border: none; font-weight: 800; cursor: pointer; font-family: 'Orbitron'; text-transform: uppercase; color: #fff; margin-bottom: 8px; transition: 0.2s; }
        button:active { transform: scale(0.95); }
        .btn-blue { background: linear-gradient(135deg, #00d2ff, #3a7bd5); }
        .btn-green { background: #00b894; }
        
        .shop-list, .locker-grid, .dict-list { flex: 1; overflow-y: auto; padding-right: 5px; }
        .locker-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; }
        .item-card { background: #111; border: 2px solid #333; border-radius: 12px; height: 60px; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; cursor: pointer; }
        .item-card.active { border-color: var(--neon); background: rgba(0, 242, 255, 0.1); }

        input { width: 100%; padding: 15px; border-radius: 10px; border: 2px solid #333; background: #000; color: #fff; text-align: center; font-size: 1.1rem; margin-bottom: 10px; }
        .info-box { background: rgba(255,255,255,0.05); padding: 10px; border-radius: 10px; font-size: 0.8rem; line-height: 1.4; }
        .spotify-btn { background: #1DB954; color: white; display: flex; align-items: center; justify-content: center; gap: 10px; }
    </style>
</head>
<body>

<div class="rgb-bg" id="particles"></div>

<div class="app" id="screen-menu">
    <div class="road" id="road-ui"></div>
    
    <div class="profile-card">
        <div id="p-avatar" style="font-size:2rem; width:60px; height:60px; background:#000; border-radius:15px; display:flex; align-items:center; justify-content:center; border:2px solid var(--neon)">ğŸ‘¶ğŸ»</div>
        <div style="flex:1">
            <h2 id="p-name" style="margin:0; font-size:1rem; font-family:'Orbitron'">ÅADUJÄ˜...</h2>
            <div style="font-size:0.75rem">ğŸ† <span id="p-cups">0</span> | ğŸ’° <span id="p-coins">0</span></div>
        </div>
        <div onclick="showScreen('screen-settings')" style="cursor:pointer; font-size:1.5rem">âš™ï¸</div>
    </div>

    <button class="btn-blue" onclick="showScreen('screen-dict')">GRA RANKINGOWA / SÅOWNIK ğŸŸï¸</button>
    <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px">
        <button style="background:#e67e22" onclick="showScreen('screen-shop')">SKLEP ğŸ’°</button>
        <button style="background:#6c5ce7" onclick="showScreen('screen-locker')">SZAFKA ğŸ‘•</button>
    </div>
    <button style="background:#d63031" onclick="showScreen('screen-multi')">ONLINE: SÅOWA I ZDANIA ğŸŒ</button>
    <button class="spotify-btn" onclick="window.open('https://open.spotify.com', '_blank')">MOJA PLAYLISTA ğŸµ</button>
    
    <div style="background:var(--card); border-radius:15px; padding:10px; flex:1; overflow-y:auto; border: 1px solid #222">
        <h4 style="margin:0 0 10px 0; font-family:'Orbitron'; font-size:0.7rem; color:var(--neon)">RANKING GLOBALNY</h4>
        <div id="leader-list" style="font-size:0.8rem"></div>
    </div>
</div>

<div class="app hidden" id="screen-dict">
    <button onclick="showScreen('screen-menu')">POWRÃ“T</button>
    <h3 style="font-family:'Orbitron'; text-align:center">ARENY RANKINGOWE</h3>
    <div id="arena-list" style="margin-bottom: 20px;"></div>
    <h3 style="font-family:'Orbitron'; text-align:center">SÅOWNIK</h3>
    <div id="dict-content" class="dict-list"></div>
</div>

<div class="app hidden" id="screen-game">
    <div style="display:flex; justify-content:space-between; color:var(--neon); font-family:'Orbitron'; font-size:0.8rem">
        <span id="g-info">ARENA 1</span>
        <span>Å»YCIA: <span id="g-lives">â¤ï¸â¤ï¸â¤ï¸</span></span>
    </div>
    <div style="text-align:center; margin-top:10px; font-size:0.8rem">POSTÄ˜P: <span id="g-count">1</span>/<span id="g-total">50</span></div>
    
    <div id="g-word" style="font-size: 2rem; margin: 40px 0; text-align:center; font-family:'Orbitron'; text-shadow: 0 0 10px var(--neon)">WORD</div>
    <input type="text" id="g-input" placeholder="TÅUMACZENIE..." autocomplete="off">
    <button class="btn-green" onclick="checkWord()">SPRAWDÅ¹ âœ…</button>
    <div id="g-feedback" style="text-align:center; min-height:30px; font-weight:bold; margin-top:10px"></div>
</div>

<div class="app hidden" id="screen-shop">
    <button onclick="showScreen('screen-menu')">POWRÃ“T</button>
    <h3 style="font-family:'Orbitron'; text-align:center">MEGA SKLEP</h3>
    <div id="shop-items" class="shop-list"></div>
</div>

<div class="app hidden" id="screen-locker">
    <button onclick="showScreen('screen-menu')">POWRÃ“T</button>
    <h3 style="font-family:'Orbitron'; text-align:center">TWOJA SZAFKA</h3>
    <div id="locker-items" class="locker-grid"></div>
</div>

<div class="app hidden" id="screen-settings">
    <button onclick="showScreen('screen-menu')">POWRÃ“T</button>
    <div class="profile-card" style="flex-direction:column">
        <h4 style="font-family:'Orbitron'">USTAWIENIA</h4>
        <input type="text" id="new-nick" placeholder="NOWY NICK...">
        <button class="btn-blue" onclick="updateNick()">ZMIEÅƒ NAZWÄ˜</button>
        <button style="background:#444" id="sound-toggle" onclick="toggleSound()">DÅ¹WIÄ˜K: ON</button>
    </div>
    <div class="info-box" style="margin-top:10px">
        <h4 style="font-family:'Orbitron'; color:var(--neon)">INFORMACJE</h4>
        Arena 1: 50 sÅ‚Ã³w | Areny 2-5: 30 sÅ‚Ã³w.<br>
        Nagroda: 50ğŸ† za kaÅ¼dÄ… arenÄ™.<br>
        BÅ‚Ä™dy: Dozwolone 3 bÅ‚Ä™dy. 4 bÅ‚Ä…d = Koniec gry.<br>
        BÅ‚Ä™dne sÅ‚owa wracajÄ… na koniec lekcji!
    </div>
</div>

<div class="app hidden" id="screen-multi">
    <button onclick="showScreen('screen-menu')">POWRÃ“T</button>
    <h3 style="font-family:'Orbitron'; text-align:center">ONLINE PVP</h3>
    <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px; margin-bottom:10px">
        <button class="btn-blue" onclick="multiMode('words')">TRYB: SÅOWA</button>
        <button class="btn-blue" style="background:#6c5ce7" onclick="multiMode('sentences')">TRYB: ZDANIA</button>
    </div>
    <input type="text" id="multi-code" placeholder="KOD POKOJU...">
    <button class="btn-green" onclick="hostRoom()">STWÃ“RZ POKÃ“J</button>
    <button style="background:#222" onclick="joinRoom()">DOÅÄ„CZ DO GRY</button>
    <div id="multi-status" style="text-align:center; margin-top:20px; color:var(--neon)"></div>
</div>

<script>
// --- KONFIGURACJA FIREBASE ---
const firebaseConfig = { apiKey: "AIzaSyCREz6ZMk86TW-dASBLNIHUTr5XDXZrTPE", authDomain: "english-game-d3ccd.firebaseapp.com", databaseURL: "https://english-game-d3ccd-default-rtdb.europe-west1.firebasedatabase.app", projectId: "english-game-d3ccd" };
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// --- BAZA SÅÃ“WEK ---
const ARENAS = {
    1: { name: "PODSTAWY", total: 50, req: 0, words: [
        {en:"I", pl:"ja"},{en:"you", pl:"ty"},{en:"he", pl:"on"},{en:"she", pl:"ona"},{en:"it", pl:"ono"},{en:"we", pl:"my"},{en:"they", pl:"oni"},
        {en:"me", pl:"mnie"},{en:"him", pl:"jego"},{en:"her", pl:"jej"},{en:"us", pl:"nas"},{en:"them", pl:"ich"},{en:"my", pl:"mÃ³j"},{en:"your", pl:"twÃ³j"},
        {en:"what", pl:"co"},{en:"which", pl:"ktÃ³ry"},{en:"who", pl:"kto"},{en:"where", pl:"gdzie"},{en:"when", pl:"kiedy"},{en:"why", pl:"dlaczego"},
        {en:"in", pl:"w"},{en:"on", pl:"na"},{en:"at", pl:"przy"},{en:"to", pl:"do"},{en:"from", pl:"z"},{en:"and", pl:"i"},{en:"but", pl:"ale"},
        {en:"mother", pl:"mama"},{en:"father", pl:"tata"},{en:"school", pl:"szkoÅ‚a"},{en:"teacher", pl:"nauczyciel"},{en:"book", pl:"ksiÄ…Å¼ka"},
        {en:"house", pl:"dom"},{en:"water", pl:"woda"},{en:"food", pl:"jedzenie"},{en:"cat", pl:"kot"},{en:"dog", pl:"pies"},{en:"time", pl:"czas"},
        {en:"day", pl:"dzieÅ„"},{en:"be", pl:"byÄ‡"},{en:"have", pl:"mieÄ‡"},{en:"do", pl:"robiÄ‡"},{en:"say", pl:"mÃ³wiÄ‡"},{en:"go", pl:"iÅ›Ä‡"},
        {en:"good", pl:"dobry"},{en:"bad", pl:"zÅ‚y"},{en:"big", pl:"duÅ¼y"},{en:"small", pl:"maÅ‚y"},{en:"happy", pl:"szczÄ™Å›liwy"},{en:"sad", pl:"smutny"}
    ]},
    2: { name: "ARENA 2", total: 30, req: 100, words: [
        {en:"become", pl:"stawaÄ‡ siÄ™"},{en:"seem", pl:"wydawaÄ‡ siÄ™"},{en:"change", pl:"zmieniaÄ‡"},{en:"start", pl:"zaczynaÄ‡"},{en:"finish", pl:"koÅ„czyÄ‡"},
        {en:"help", pl:"pomagaÄ‡"},{en:"wait", pl:"czekaÄ‡"},{en:"stay", pl:"zostawaÄ‡"},{en:"leave", pl:"opuszczaÄ‡"},{en:"find", pl:"znajdowaÄ‡"},
        {en:"lose", pl:"traciÄ‡"},{en:"win", pl:"wygrywaÄ‡"},{en:"try", pl:"prÃ³bowaÄ‡"},{en:"need", pl:"potrzebowaÄ‡"},{en:"want", pl:"chcieÄ‡"},
        {en:"like", pl:"lubiÄ‡"},{en:"love", pl:"kochaÄ‡"},{en:"hate", pl:"nienawidziÄ‡"},{en:"think", pl:"myÅ›leÄ‡"},{en:"know", pl:"wiedzieÄ‡"},
        {en:"learn", pl:"uczyÄ‡ siÄ™"},{en:"remember", pl:"pamiÄ™taÄ‡"},{en:"forget", pl:"zapominaÄ‡"},{en:"feel", pl:"czuÄ‡"},{en:"work", pl:"pracowaÄ‡"},
        {en:"live", pl:"mieszkaÄ‡"},{en:"travel", pl:"podrÃ³Å¼owaÄ‡"},{en:"buy", pl:"kupowaÄ‡"},{en:"pay", pl:"pÅ‚aciÄ‡"},{en:"meet", pl:"spotykaÄ‡"}
    ]},
    3: { name: "ARENA 3", total: 30, req: 300, words: [
        {en:"decide", pl:"decydowaÄ‡"},{en:"plan", pl:"planowaÄ‡"},{en:"prepare", pl:"przygotowywaÄ‡"},{en:"create", pl:"tworzyÄ‡"},{en:"destroy", pl:"niszczyÄ‡"},
        {en:"build", pl:"budowaÄ‡"},{en:"repair", pl:"naprawiaÄ‡"},{en:"protect", pl:"chroniÄ‡"},{en:"allow", pl:"pozwalaÄ‡"},{en:"prevent", pl:"zapobiegaÄ‡"},
        {en:"refuse", pl:"odmawiaÄ‡"},{en:"accept", pl:"akceptowaÄ‡"},{en:"explain", pl:"wyjaÅ›niaÄ‡"},{en:"describe", pl:"opisywaÄ‡"},{en:"promise", pl:"obiecywaÄ‡"},
        {en:"warn", pl:"ostrzegaÄ‡"},{en:"suggest", pl:"sugerowaÄ‡"},{en:"agree", pl:"zgadzaÄ‡ siÄ™"},{en:"trust", pl:"ufaÄ‡"},{en:"choose", pl:"wybieraÄ‡"},
        {en:"reject", pl:"odrzucaÄ‡"},{en:"cancel", pl:"odwoÅ‚ywaÄ‡"},{en:"continue", pl:"kontynuowaÄ‡"},{en:"break", pl:"Å‚amaÄ‡"},{en:"cut", pl:"ciÄ…Ä‡"},
        {en:"catch", pl:"Å‚apaÄ‡"},{en:"hide", pl:"chowaÄ‡"},{en:"escape", pl:"uciekaÄ‡"},{en:"survive", pl:"przetrwaÄ‡"},{en:"attack", pl:"atakowaÄ‡"}
    ]},
    4: { name: "ARENA 4", total: 30, req: 600, words: [
        {en:"appear", pl:"pojawiaÄ‡ siÄ™"},{en:"disappear", pl:"znikaÄ‡"},{en:"belong", pl:"naleÅ¼eÄ‡"},{en:"include", pl:"zawieraÄ‡"},{en:"affect", pl:"wpÅ‚ywaÄ‡"},
        {en:"realize", pl:"uÅ›wiadamiaÄ‡ sobie"},{en:"expect", pl:"oczekiwaÄ‡"},{en:"imagine", pl:"wyobraÅ¼aÄ‡ sobie"},{en:"consider", pl:"rozwaÅ¼aÄ‡"},{en:"admit", pl:"przyznawaÄ‡ siÄ™"},
        {en:"deny", pl:"zaprzeczaÄ‡"},{en:"demand", pl:"Å¼Ä…daÄ‡"},{en:"force", pl:"zmuszaÄ‡"},{en:"discover", pl:"odkrywaÄ‡"},{en:"invent", pl:"wynajdywaÄ‡"},
        {en:"explore", pl:"eksplorowaÄ‡"},{en:"research", pl:"badaÄ‡"},{en:"prove", pl:"udowadniaÄ‡"},{en:"doubt", pl:"wÄ…tpiÄ‡"},{en:"notice", pl:"zauwaÅ¼aÄ‡"},
        {en:"observe", pl:"obserwowaÄ‡"},{en:"compare", pl:"porÃ³wnywaÄ‡"},{en:"connect", pl:"Å‚Ä…czyÄ‡"},{en:"separate", pl:"oddzielaÄ‡"},{en:"collect", pl:"zbieraÄ‡"},
        {en:"store", pl:"przechowywaÄ‡"},{en:"waste", pl:"marnowaÄ‡"},{en:"earn", pl:"zarabiaÄ‡"},{en:"borrow", pl:"poÅ¼yczaÄ‡"},{en:"invest", pl:"inwestowaÄ‡"}
    ]},
    5: { name: "ARENA 5", total: 30, req: 1000, words: [
        {en:"achieve", pl:"osiÄ…gaÄ‡"},{en:"succeed", pl:"odnosiÄ‡ sukces"},{en:"fail", pl:"ponosiÄ‡ poraÅ¼kÄ™"},{en:"avoid", pl:"unikaÄ‡"},{en:"influence", pl:"wpÅ‚yw"},
        {en:"responsibility", pl:"odpowiedzialnoÅ›Ä‡"},{en:"freedom", pl:"wolnoÅ›Ä‡"},{en:"justice", pl:"sprawiedliwoÅ›Ä‡"},{en:"society", pl:"spoÅ‚eczeÅ„stwo"},{en:"environment", pl:"Å›rodowisko"},
        {en:"pollution", pl:"zanieczyszczenie"},{en:"technology", pl:"technologia"},{en:"device", pl:"urzÄ…dzenie"},{en:"system", pl:"system"},{en:"impact", pl:"wpÅ‚yw"},
        {en:"solution", pl:"rozwiÄ…zanie"},{en:"opportunity", pl:"okazja"},{en:"priority", pl:"priorytet"},{en:"quality", pl:"jakoÅ›Ä‡"},{en:"value", pl:"wartoÅ›Ä‡"},
        {en:"profit", pl:"zysk"},{en:"lifestyle", pl:"styl Å¼ycia"},{en:"culture", pl:"kultura"},{en:"tradition", pl:"tradycja"},{en:"meaning", pl:"znaczenie"},
        {en:"translation", pl:"tÅ‚umaczenie"},{en:"opinion", pl:"opinia"},{en:"experience", pl:"doÅ›wiadczenie"},{en:"skill", pl:"umiejÄ™tnoÅ›Ä‡"},{en:"success", pl:"sukces"}
    ]}
};

const SKLEP_ITEMS = [
    {id:'b1', n:'BOMBA ğŸ’£', p:50, type:'tool'}, {id:'x2', n:'MNOÅ»NIK X2 âš¡', p:100, type:'tool'},
    {id:'c1', n:'BÅÄ˜KIT NICK', p:200, type:'color', val:'#00f2ff'}, {id:'c2', n:'ZÅOTY NICK', p:500, type:'color', val:'#ffd700'},
    {id:'e1', n:'NINJA SKÃ“RKA', p:300, type:'emo', val:'ğŸ¥·'}, {id:'e2', n:'ROBOT SKÃ“RKA', p:400, type:'emo', val:'ğŸ¤–'},
    {id:'e3', n:'KRÃ“L SKÃ“RKA', p:1000, type:'emo', val:'ğŸ‘‘'}, {id:'e4', n:'SMOK SKÃ“RKA', p:800, type:'emo', val:'ğŸ²'},
    {id:'e5', n:'KOSMITA', p:600, type:'emo', val:'ğŸ‘½'}, {id:'e6', n:'CZASZKA', p:400, type:'emo', val:'ğŸ’€'}
    // ... dopeÅ‚nienie do 25 przedmiotÃ³w w logice renderowania
];

// --- STAN GRACZA ---
let user = JSON.parse(localStorage.getItem('e8_final_user')) || {
    name: "GRACZ", avatar: "ğŸ‘¶ğŸ»", cups: 0, coins: 50, arena: 1, sound: true,
    owned: ['ğŸ‘¶ğŸ»', '#ffffff'], cur_color: '#ffffff'
};
let game = { active: false, arena: 1, lives: 3, pool: [], idx: 0, mistakes: [] };

function save() {
    localStorage.setItem('e8_final_user', JSON.stringify(user));
    if(user.name !== "GRACZ") db.ref('users/' + (localStorage.getItem('e8_uid') || 'u1')).set(user);
    updateUI();
}

function updateUI() {
    document.getElementById('p-name').textContent = user.name;
    document.getElementById('p-name').style.color = user.cur_color;
    document.getElementById('p-avatar').textContent = user.avatar;
    document.getElementById('p-cups').textContent = user.cups;
    document.getElementById('p-coins').textContent = user.coins;
    renderRoad();
    renderLocker();
    renderShop();
    renderArenas();
}

function renderRoad() {
    let h = '';
    for(let i=0; i<=2000; i+=100) {
        h += `<div class="node ${user.cups >= i ? 'unlocked' : ''}">
                <div class="node-circle">${i % 500 === 0 ? 'ğŸ' : i}</div>
              </div>`;
    }
    document.getElementById('road-ui').innerHTML = h;
}

// --- LOGIKA GRY ---
function startArena(id) {
    if(user.cups < ARENAS[id].req) return alert("ZdobÄ…dÅº wiÄ™cej pucharkÃ³w!");
    game.active = true;
    game.arena = id;
    game.lives = 3;
    game.idx = 0;
    game.mistakes = [];
    game.pool = [...ARENAS[id].words].sort(() => 0.5 - Math.random());
    showScreen('screen-game');
    updateGameUI();
}

function updateGameUI() {
    let cur = game.pool[game.idx];
    document.getElementById('g-info').textContent = ARENAS[game.arena].name;
    document.getElementById('g-lives').textContent = "â¤ï¸".repeat(game.lives);
    document.getElementById('g-total').textContent = game.pool.length;
    document.getElementById('g-count').textContent = game.idx + 1;
    document.getElementById('g-word').textContent = cur.en.toUpperCase();
    document.getElementById('g-input').value = "";
    document.getElementById('g-feedback').textContent = "";
}

function checkWord() {
    let val = document.getElementById('g-input').value.toLowerCase().trim();
    let ans = game.pool[game.idx].pl.toLowerCase();
    
    if(val === ans) {
        game.idx++;
        user.coins += 2;
        if(game.idx >= game.pool.length) {
            if(game.mistakes.length > 0) {
                game.pool = [...game.mistakes];
                game.mistakes = [];
                game.idx = 0;
                alert("Teraz poprawne wpisanie sÅ‚Ã³w, w ktÃ³rych byÅ‚ bÅ‚Ä…d!");
                updateGameUI();
            } else {
                finishGame(true);
            }
        } else {
            updateGameUI();
        }
    } else {
        game.mistakes.push(game.pool[game.idx]);
        game.lives--;
        document.getElementById('g-feedback').textContent = "BÅÄ„D! POPRAWNIE: " + ans.toUpperCase();
        if(game.lives < 0) finishGame(false);
        else {
            setTimeout(() => {
                game.idx++;
                if(game.idx >= game.pool.length) {
                    game.pool = [...game.mistakes];
                    game.mistakes = [];
                    game.idx = 0;
                    updateGameUI();
                } else updateGameUI();
            }, 1500);
        }
    }
}

function finishGame(win) {
    if(win) {
        user.cups += 50;
        alert("GRATULACJE! ZdobyÅ‚eÅ› 50ğŸ†!");
    } else {
        alert("GAME OVER! Za duÅ¼o bÅ‚Ä™dÃ³w.");
    }
    save();
    showScreen('screen-menu');
}

// --- SKLEP I SZAFKA ---
function renderShop() {
    let h = '';
    SKLEP_ITEMS.forEach(i => {
        h += `<div style="display:flex; align-items:center; background:#111; padding:12px; margin-bottom:8px; border-radius:12px; border:1px solid #222">
                <span style="font-size:1.5rem">${i.val || 'ğŸ“¦'}</span>
                <div style="flex:1; margin-left:15px"><b>${i.n}</b><br><small>${i.p}ğŸ’°</small></div>
                <button style="width:70px; padding:8px; font-size:0.7rem" class="btn-blue" onclick="buy('${i.id}')">KUP</button>
              </div>`;
    });
    document.getElementById('shop-items').innerHTML = h;
}

function buy(id) {
    let item = SKLEP_ITEMS.find(x => x.id === id);
    if(user.coins >= item.p) {
        user.coins -= item.p;
        user.owned.push(item.val || item.n);
        save();
        alert("Kupiono!");
    } else alert("MaÅ‚o kasy!");
}

function renderLocker() {
    let h = '';
    user.owned.forEach(item => {
        let isColor = item.startsWith('#');
        h += `<div class="item-card" onclick="equip('${item}')" style="color:${isColor ? item : '#fff'}">
                ${isColor ? 'ğŸ¨' : item}
              </div>`;
    });
    document.getElementById('locker-items').innerHTML = h;
}

function equip(val) {
    if(val.startsWith('#')) user.cur_color = val;
    else user.avatar = val;
    save();
}

function renderArenas() {
    let h = '';
    for(let id in ARENAS) {
        let lock = user.cups < ARENAS[id].req;
        h += `<button class="btn-blue" style="background:${lock?'#333':'linear-gradient(135deg,#00d2ff,#3a7bd5)'}" onclick="startArena(${id})">
                ${ARENAS[id].name} ${lock ? '(LOCKED: '+ARENAS[id].req+'ğŸ†)' : ''}
              </button>`;
    }
    document.getElementById('arena-list').innerHTML = h;
    
    // SÅ‚ownik
    let dh = '';
    ARENAS[1].words.forEach(w => {
        dh += `<div style="display:flex; justify-content:space-between; padding:8px; border-bottom:1px solid #222">
                <span>${w.en}</span><b>${w.pl}</b>
               </div>`;
    });
    document.getElementById('dict-content').innerHTML = dh;
}

// --- SYSTEM ---
function showScreen(id) {
    document.querySelectorAll('.app').forEach(s => s.classList.add('hidden'));
    document.getElementById(id).classList.remove('hidden');
}

function updateNick() {
    let n = document.getElementById('new-nick').value.trim();
    if(n) { user.name = n; save(); }
}

function toggleSound() {
    user.sound = !user.sound;
    document.getElementById('sound-toggle').textContent = "DÅ¹WIÄ˜K: " + (user.sound ? "ON" : "OFF");
    save();
}

// Multiplayer Placeholder
function hostRoom() {
    let code = Math.floor(1000 + Math.random() * 9000);
    document.getElementById('multi-status').textContent = "KOD POKOJU: " + code + " (CZEKAM NA GRACZA...)";
}
function joinRoom() {
    alert("ÅÄ…czenie z pokojem...");
}

// Start
if(!localStorage.getItem('e8_uid')) localStorage.setItem('e8_uid', 'u' + Date.now());
updateUI();
</script>
</body>
</html>
