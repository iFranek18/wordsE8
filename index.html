<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>E8 CyberQuest: Final Version</title>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@900&family=Inter:wght@400;700;800&display=swap" rel="stylesheet">
    <style>
        :root { --neon: #00f2ff; --bg: #05050a; --card: rgba(15, 15, 30, 0.98); }
        body { margin:0; font-family: 'Inter', sans-serif; background: var(--bg); color: #fff; overflow: hidden; height: 100vh; }
        .rgb-bg { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; background: #000; }
        .line { position: absolute; width: 2px; height: 40vh; filter: blur(2px); animation: move linear infinite; opacity: 0.1; background: var(--neon); }
        @keyframes move { 0% { transform: translateY(-110%); } 100% { transform: translateY(110vh); } }
        
        .app { max-width: 480px; margin: 0 auto; padding: 15px; height: 100vh; display: flex; flex-direction: column; box-sizing: border-box; }
        .hidden { display: none !important; }
        
        .profile-card { background: var(--card); padding: 12px; border-radius: 18px; border: 1px solid #333; display: flex; align-items: center; gap: 12px; margin-bottom: 10px; }
        button { width: 100%; padding: 14px; border-radius: 12px; border: none; font-weight: 800; cursor: pointer; font-family: 'Orbitron'; text-transform: uppercase; color: #fff; margin-bottom: 8px; }
        .btn-blue { background: linear-gradient(135deg, #00d2ff, #3a7bd5); }
        .btn-arena { background: #2d3436; border: 1px solid #444; font-size: 0.7rem; }
        .active-arena { border-color: var(--neon); background: #1e3799; box-shadow: 0 0 10px var(--neon); }
        
        input { width: 100%; padding: 15px; border-radius: 10px; border: 2px solid #333; background: #000; color: #fff; text-align: center; font-size: 1.1rem; margin: 15px 0; box-sizing: border-box; }
        
        .list-container { overflow-y: auto; flex: 1; padding-right: 5px; }
        .shop-item { display: flex; align-items: center; justify-content: space-between; background: #111; padding: 12px; border-radius: 12px; margin-bottom: 8px; border: 1px solid #222; }
        .grid-locker { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; }
        .item-box { background: #111; border: 2px solid #333; border-radius: 12px; height: 60px; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; cursor: pointer; }
        .item-box.active { border-color: var(--neon); background: rgba(0, 242, 255, 0.1); }

        /* SÅOWNIK MODAL */
        .arena-select { display: grid; grid-template-columns: repeat(5, 1fr); gap: 5px; margin-bottom: 15px; }
    </style>
</head>
<body>

<div class="rgb-bg" id="rgb-container"></div>

<div class="app" id="screen-menu">
    <div class="profile-card">
        <div id="p-avatar" style="font-size:2rem; width:55px; height:55px; background:#000; border-radius:12px; display:flex; align-items:center; justify-content:center; border:2px solid var(--neon)">ğŸ‘¶ğŸ»</div>
        <div style="flex:1">
            <h2 id="p-name" style="margin:0; font-size:0.9rem; font-family:'Orbitron'">GRACZ</h2>
            <div style="font-size:0.7rem">ğŸ† <span id="p-cups">0</span> | ğŸ’° <span id="p-coins">0</span></div>
            <div style="font-size:0.6rem; color:var(--neon); margin-top:2px">WYBRANA: ARENA <span id="active-arena-label">1</span></div>
        </div>
        <div onclick="toggleModal('modal-settings')" style="cursor:pointer; font-size:1.5rem">âš™ï¸</div>
    </div>

    <button class="btn-blue" onclick="startGame()">ROZPOCZNIJ LEKCJÄ˜ (20 SÅÃ“W) ğŸ“–</button>
    <button style="background:#6c5ce7" onclick="showScreen('screen-locker')">SZAFKA ğŸ‘•</button>
    <button style="background:#e67e22" onclick="showScreen('screen-shop')">MEGA SKLEP ğŸ’°</button>
    <button style="background:#2d3436" onclick="showScreen('screen-dict')">SÅOWNIK I ARENY ğŸŸï¸</button>
    
    <div style="background:var(--card); border-radius:12px; padding:10px; margin-top:5px; flex:1; overflow-y:auto; border: 1px solid #222">
        <h4 style="margin:0 0 8px 0; font-family:'Orbitron'; font-size:0.6rem; color:var(--neon)">RANKING GLOBALNY</h4>
        <div id="leader-list" style="font-size:0.75rem"></div>
    </div>
</div>

<div class="app hidden" id="screen-dict">
    <button onclick="showScreen('screen-menu')">POWRÃ“T</button>
    <h3 style="font-family:'Orbitron'; text-align:center; font-size:0.8rem">WYBIERZ ARENÄ˜ DO NAUKI</h3>
    <div class="arena-select" id="arena-btns"></div>
    <div id="dict-list" class="list-container" style="font-size:0.8rem"></div>
</div>

<div class="app hidden" id="screen-locker">
    <button onclick="showScreen('screen-menu')">POWRÃ“T</button>
    <h3 style="font-family:'Orbitron'; text-align:center">TWOJA SZAFKA</h3>
    <div id="locker-grid" class="grid-locker"></div>
</div>

<div class="app hidden" id="screen-shop">
    <button onclick="showScreen('screen-menu')">POWRÃ“T</button>
    <h3 style="font-family:'Orbitron'; text-align:center">MEGA SKLEP</h3>
    <div id="shop-list" class="list-container"></div>
</div>

<div class="app hidden" id="screen-game">
    <div style="display:flex; justify-content:space-between; color:var(--neon); font-family:'Orbitron'; font-size:0.7rem">
        <span id="g-info">ARENA 1</span>
        <span>BÅÄ˜DY: <span id="g-err" style="color:#ff4d4d">0</span>/5</span>
    </div>
    <div style="text-align:center; margin-top:10px; font-size:0.7rem">POSTÄ˜P: <span id="g-count">1</span>/20</div>
    
    <div id="g-word" style="font-size: 2rem; margin: 40px 0; text-align:center; font-family:'Orbitron'; text-shadow: 0 0 10px var(--neon)">WORD</div>
    <input type="text" id="g-input" placeholder="TÅUMACZENIE..." autocomplete="off">
    <button class="btn-blue" style="background:#00b894" onclick="checkWord()">SPRAWDÅ¹ âœ…</button>
    <div id="g-feedback" style="text-align:center; height:30px; font-weight:bold"></div>
</div>

<div id="modal-settings" class="hidden">
    <div class="overlay" onclick="toggleModal('modal-settings')"></div>
    <div class="modal" style="position:fixed; top:50%; left:50%; transform:translate(-50%,-50%); background:var(--card); padding:20px; border-radius:20px; border:2px solid var(--neon); z-index:101; width:80%">
        <h3 style="font-family:'Orbitron'">ZMIEÅƒ NICK</h3>
        <input type="text" id="input-nick" placeholder="WPISZ NAZWÄ˜...">
        <button class="btn-blue" onclick="saveNick()">ZAPISZ</button>
    </div>
</div>

<script>
// --- CONFIG & DATA ---
const firebaseConfig = { apiKey: "AIzaSyCREz6ZMk86TW-dASBLNIHUTr5XDXZrTPE", authDomain: "english-game-d3ccd.firebaseapp.com", databaseURL: "https://english-game-d3ccd-default-rtdb.europe-west1.firebasedatabase.app", projectId: "english-game-d3ccd" };
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

const WORDS_DATA = {
    1: [
        {en:"I", pl:"ja"},{en:"you", pl:"ty"},{en:"he", pl:"on"},{en:"she", pl:"ona"},{en:"it", pl:"ono"},{en:"we", pl:"my"},{en:"they", pl:"oni"},
        {en:"me", pl:"mnie"},{en:"him", pl:"jego"},{en:"her", pl:"jej"},{en:"us", pl:"nas"},{en:"them", pl:"ich"},{en:"my", pl:"mÃ³j"},{en:"your", pl:"twÃ³j"},
        {en:"his", pl:"jego"},{en:"her", pl:"jej"},{en:"its", pl:"jego"},{en:"our", pl:"nasz"},{en:"their", pl:"ich"},{en:"what", pl:"co"},
        {en:"which", pl:"ktÃ³ry"},{en:"who", pl:"kto"},{en:"whom", pl:"kogo"},{en:"whose", pl:"czyj"},{en:"where", pl:"gdzie"},{en:"when", pl:"kiedy"},
        {en:"why", pl:"dlaczego"},{en:"how", pl:"jak"},{en:"in", pl:"w"},{en:"on", pl:"na"},{en:"at", pl:"przy"},{en:"to", pl:"do"},{en:"from", pl:"z"},
        {en:"with", pl:"z"},{en:"about", pl:"o"},{en:"for", pl:"dla"},{en:"of", pl:"czegoÅ›"},{en:"into", pl:"do"},{en:"out", pl:"na zewnÄ…trz"},
        {en:"up", pl:"w gÃ³rÄ™"},{en:"down", pl:"w dÃ³Å‚"},{en:"between", pl:"miÄ™dzy"},{en:"among", pl:"wÅ›rÃ³d"},{en:"over", pl:"nad"},{en:"under", pl:"pod"},
        {en:"and", pl:"i"},{en:"but", pl:"ale"},{en:"or", pl:"lub"},{en:"because", pl:"poniewaÅ¼"},{en:"so", pl:"wiÄ™c"},{en:"if", pl:"jeÅ›li"}
    ],
    2: [
        {en:"become", pl:"stawaÄ‡ siÄ™"},{en:"seem", pl:"wydawaÄ‡ siÄ™"},{en:"change", pl:"zmieniaÄ‡"},{en:"start", pl:"zaczynaÄ‡"},{en:"finish", pl:"koÅ„czyÄ‡"},
        {en:"help", pl:"pomagaÄ‡"},{en:"wait", pl:"czekaÄ‡"},{en:"stay", pl:"zostawaÄ‡"},{en:"leave", pl:"opuszczaÄ‡"},{en:"find", pl:"znajdowaÄ‡"},
        {en:"lose", pl:"gubiÄ‡"},{en:"win", pl:"wygrywaÄ‡"},{en:"choose", pl:"wybieraÄ‡"},{en:"try", pl:"prÃ³bowaÄ‡"},{en:"need", pl:"potrzebowaÄ‡"},
        {en:"want", pl:"chcieÄ‡"},{en:"like", pl:"lubiÄ‡"},{en:"love", pl:"kochaÄ‡"},{en:"hate", pl:"nienawidziÄ‡"},{en:"enjoy", pl:"cieszyÄ‡ siÄ™"},
        {en:"think", pl:"myÅ›leÄ‡"},{en:"know", pl:"wiedzieÄ‡"},{en:"learn", pl:"uczyÄ‡ siÄ™"},{en:"remember", pl:"pamiÄ™taÄ‡"},{en:"forget", pl:"zapominaÄ‡"},
        {en:"hope", pl:"mieÄ‡ nadziejÄ™"},{en:"believe", pl:"wierzyÄ‡"},{en:"feel", pl:"czuÄ‡"},{en:"look", pl:"wyglÄ…daÄ‡"},{en:"sound", pl:"brzmieÄ‡"}
    ],
    3: [
        {en:"decide", pl:"decydowaÄ‡"},{en:"plan", pl:"planowaÄ‡"},{en:"prepare", pl:"przygotowywaÄ‡"},{en:"organize", pl:"organizowaÄ‡"},{en:"arrange", pl:"ustalaÄ‡"},
        {en:"manage", pl:"zarzÄ…dzaÄ‡"},{en:"control", pl:"kontrolowaÄ‡"},{en:"improve", pl:"poprawiaÄ‡"},{en:"reduce", pl:"zmniejszaÄ‡"},{en:"increase", pl:"zwiÄ™kszaÄ‡"},
        {en:"create", pl:"tworzyÄ‡"},{en:"destroy", pl:"niszczyÄ‡"},{en:"build", pl:"budowaÄ‡"},{en:"repair", pl:"naprawiaÄ‡"},{en:"replace", pl:"zastÄ™powaÄ‡"},
        {en:"protect", pl:"chroniÄ‡"},{en:"allow", pl:"pozwalaÄ‡"},{en:"prevent", pl:"zapobiegaÄ‡"},{en:"refuse", pl:"odmawiaÄ‡"},{en:"accept", pl:"akceptowaÄ‡"}
    ],
    4: [
        {en:"appear", pl:"pojawiaÄ‡ siÄ™"},{en:"disappear", pl:"znikaÄ‡"},{en:"remain", pl:"pozostawaÄ‡"},{en:"belong", pl:"naleÅ¼eÄ‡"},{en:"include", pl:"zawieraÄ‡"},
        {en:"contain", pl:"zawieraÄ‡"},{en:"affect", pl:"wpÅ‚ywaÄ‡"},{en:"depend", pl:"zaleÅ¼eÄ‡"},{en:"realize", pl:"uÅ›wiadamiaÄ‡"},{en:"expect", pl:"oczekiwaÄ‡"},
        {en:"imagine", pl:"wyobraÅ¼aÄ‡"},{en:"consider", pl:"rozwaÅ¼aÄ‡"},{en:"admit", pl:"przyznawaÄ‡ siÄ™"},{en:"deny", pl:"zaprzeczaÄ‡"},{en:"demand", pl:"Å¼Ä…daÄ‡"}
    ],
    5: [
        {en:"achieve", pl:"osiÄ…gaÄ‡"},{en:"succeed", pl:"odnosiÄ‡ sukces"},{en:"fail", pl:"ponosiÄ‡ poraÅ¼kÄ™"},{en:"handle", pl:"radziÄ‡ sobie"},{en:"avoid", pl:"unikaÄ‡"},
        {en:"influence", pl:"wpÅ‚yw"},{en:"freedom", pl:"wolnoÅ›Ä‡"},{en:"justice", pl:"sprawiedliwoÅ›Ä‡"},{en:"society", pl:"spoÅ‚eczeÅ„stwo"},{en:"community", pl:"spoÅ‚ecznoÅ›Ä‡"},
        {en:"environment", pl:"Å›rodowisko"},{en:"pollution", pl:"zanieczyszczenie"},{en:"climate", pl:"klimat"},{en:"resource", pl:"zasÃ³b"},{en:"energy", pl:"energia"}
    ]
};

const SHOP_ITEMS = [
    {id:'c1', n:'BÅÄ˜KIT', p:200, type:'color', val:'#00f2ff'}, {id:'c2', n:'ZÅOTO', p:800, type:'color', val:'#ffd700'}, {id:'c3', n:'NEON RÃ“Å»', p:400, type:'color', val:'#ff00ff'},
    {id:'e1', n:'NINJA', p:300, type:'emo', val:'ğŸ¥·'}, {id:'e2', n:'KRÃ“L', p:1500, type:'emo', val:'ğŸ‘‘'}, {id:'e3', n:'DUCH', p:200, type:'emo', val:'ğŸ‘»'},
    {id:'e4', n:'ROBOT', p:500, type:'emo', val:'ğŸ¤–'}, {id:'e5', n:'KOSMITA', p:600, type:'emo', val:'ğŸ‘½'}, {id:'e6', n:'CZASZKA', p:400, type:'emo', val:'ğŸ’€'},
    {id:'e7', n:'SMOK', p:1200, type:'emo', val:'ğŸ²'}, {id:'e8', n:'DIAMENT', p:2000, type:'emo', val:'ğŸ’'}, {id:'e9', n:'REKIN', p:700, type:'emo', val:'ğŸ¦ˆ'},
    {id:'e10', n:'WILK', p:850, type:'emo', val:'ğŸº'}, {id:'e11', n:'PANDA', p:500, type:'emo', val:'ğŸ¼'}, {id:'e12', n:'PIÅKA', p:150, type:'emo', val:'âš½'},
    {id:'e13', n:'GAMER', p:400, type:'emo', val:'ğŸ®'}, {id:'e14', n:'RAKIETA', p:1000, type:'emo', val:'ğŸš€'}, {id:'e15', n:'KOT', p:200, type:'emo', val:'ğŸ±'}
];

// --- STATE ---
let user = JSON.parse(localStorage.getItem('e8_f')) || {
    name: "GRACZ", avatar: "ğŸ‘¶ğŸ»", cups: 0, coins: 50, arena: 1,
    owned_e: ['ğŸ‘¶ğŸ»'], owned_c: ['#ffffff'], cur_c: '#ffffff'
};
let game = { idx:0, err:0, pool:[], cur:null, dir:'' };

function save() {
    localStorage.setItem('e8_f', JSON.stringify(user));
    if(user.name !== "GRACZ") db.ref('players/' + (localStorage.getItem('e8_uid') || 'u1')).set(user);
    updateUI();
}

function updateUI() {
    document.getElementById('p-name').textContent = user.name;
    document.getElementById('p-name').style.color = user.cur_c;
    document.getElementById('p-avatar').textContent = user.avatar;
    document.getElementById('p-cups').textContent = user.cups;
    document.getElementById('p-coins').textContent = user.coins;
    document.getElementById('active-arena-label').textContent = user.arena;
    renderLocker();
    renderShop();
    renderDict();
}

// --- LOGIKA AREN I SÅOWNIKA ---
function renderDict() {
    const btns = document.getElementById('arena-btns');
    btns.innerHTML = '';
    for(let i=1; i<=5; i++) {
        btns.innerHTML += `<button class="btn-arena ${user.arena==i?'active-arena':''}" onclick="setArena(${i})">A${i}</button>`;
    }
    const list = document.getElementById('dict-list');
    list.innerHTML = WORDS_DATA[user.arena].map(w => `<div style="display:flex; justify-content:space-between; padding:5px; border-bottom:1px solid #222"><span>${w.en}</span><b>${w.pl}</b></div>`).join('');
}

function setArena(a) { user.arena = a; save(); }

// --- LEKCJA ---
function startGame() {
    // ÅÄ…czymy sÅ‚Ã³wka z obecnej areny i poprzednich
    let combined = [];
    for(let i=1; i<=user.arena; i++) combined = [...combined, ...WORDS_DATA[i]];
    
    game.pool = combined.sort(() => 0.5 - Math.random()).slice(0, 20);
    game.idx = 0; game.err = 0;
    showScreen('screen-game');
    document.getElementById('g-info').textContent = "ARENA " + user.arena;
    nextWord();
}

function nextWord() {
    game.cur = game.pool[game.idx];
    game.dir = Math.random() > 0.5 ? 'en' : 'pl';
    document.getElementById('g-word').textContent = (game.dir == 'en' ? game.cur.en : game.cur.pl).toUpperCase();
    document.getElementById('g-input').value = "";
    document.getElementById('g-count').textContent = game.idx + 1;
    document.getElementById('g-err').textContent = game.err;
    document.getElementById('g-feedback').textContent = "";
}

function checkWord() {
    let val = document.getElementById('g-input').value.toLowerCase().trim();
    let ans = (game.dir == 'en' ? game.cur.pl : game.cur.en).toLowerCase().trim();
    
    if(val == ans) {
        game.idx++;
        user.coins += 5;
        if(game.idx >= 20) finishGame(); else nextWord();
    } else {
        game.err++;
        document.getElementById('g-feedback').textContent = "BÅÄ„D! POPRAWNIE: " + ans.toUpperCase();
        document.getElementById('g-feedback').style.color = "#ff4d4d";
        if(game.err > 5) {
            alert("PRZEGRAÅEÅš! Ponad 5 bÅ‚Ä™dÃ³w.");
            showScreen('screen-menu');
        } else {
            // Po bÅ‚Ä™dzie czekamy chwilÄ™ i dajemy nastÄ™pne sÅ‚owo mimo bÅ‚Ä™du
            setTimeout(() => { if(game.err <= 5) { game.idx++; if(game.idx >= 20) finishGame(); else nextWord(); } }, 1500);
        }
    }
}

function finishGame() {
    let bonus = 0;
    if(game.err <= 1) bonus = 30;
    else if(game.err <= 3) bonus = 20;
    else if(game.err <= 5) bonus = 10;
    
    user.cups += bonus;
    save();
    alert(`KONIEC! BÅ‚Ä™dy: ${game.err}. Zdobyte pucharki: ${bonus}ğŸ†`);
    showScreen('screen-menu');
}

// --- SKLEP I SZAFKA ---
function renderShop() {
    document.getElementById('shop-list').innerHTML = SHOP_ITEMS.map(i => `
        <div class="shop-item">
            <span style="font-size:1.5rem; color:${i.type=='color'?i.val:'#fff'}">${i.type=='color'?'ğŸ¨':i.val}</span>
            <div style="flex:1; margin-left:15px"><b>${i.n}</b><br><small>${i.p} ğŸ’°</small></div>
            <button style="width:70px; padding:8px; font-size:0.6rem" class="btn-blue" onclick="buy('${i.id}')">KUP</button>
        </div>
    `).join('');
}

function buy(id) {
    let itm = SHOP_ITEMS.find(x => x.id == id);
    if(user.coins >= itm.p) {
        user.coins -= itm.p;
        if(itm.type == 'color') user.owned_c.push(itm.val);
        else user.owned_e.push(itm.val);
        save(); alert("KUPIONO!");
    } else alert("BRAK MONET!");
}

function renderLocker() {
    document.getElementById('locker-grid').innerHTML = 
        user.owned_e.map(e => `<div class="item-box ${user.avatar==e?'active':''}" onclick="user.avatar='${e}';save()">${e}</div>`).join('') +
        user.owned_c.map(c => `<div class="item-box ${user.cur_c==c?'active':''}" style="color:${c}" onclick="user.cur_c='${c}';save()">ğŸ¨</div>`).join('');
}

// --- SYSTEM ---
function toggleModal(id) { document.getElementById(id).classList.toggle('hidden'); }
function showScreen(id) { document.querySelectorAll('.app').forEach(s => s.classList.add('hidden')); document.getElementById(id).classList.remove('hidden'); }
function saveNick() {
    let n = document.getElementById('input-nick').value.trim().toUpperCase();
    if(n && n !== "GRACZ") { user.name = n; save(); toggleModal('modal-settings'); }
}

db.ref('players').orderByChild('cups').limitToLast(10).on('value', snap => {
    let h = '';
    snap.forEach(c => {
        let p = c.val();
        if(p.name !== "GRACZ") h = `<div style="color:${p.cur_c}; margin-bottom:4px">${p.avatar} ${p.name} â€” ${p.cups}ğŸ†</div>` + h;
    });
    document.getElementById('leader-list').innerHTML = h;
});

if(!localStorage.getItem('e8_uid')) localStorage.setItem('e8_uid', 'u' + Date.now());
for(let i=0; i<15; i++) {
    let l = document.createElement('div'); l.className = 'line';
    l.style.left = Math.random()*100+'%'; l.style.animationDuration = (Math.random()*3+2)+'s';
    document.getElementById('rgb-container').appendChild(l);
}
save();
</script>
</body>
</html>
